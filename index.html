<!doctype html>
<head><meta charset="utf-8"><title>Function implementation hiding</title><script type="application/json" id="menu-search-biblio">[{"type":"clause","id":"introduction","aoid":null,"title":"Introduction","titleHTML":"Introduction","number":"","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Introduction"},{"type":"term","term":"Directive Prologue","refId":"sec-directive-prologues-and-the-use-strict-directive","referencingIds":["_ref_1","_ref_2","_ref_4","_ref_6","_ref_8","_ref_10","_ref_11","_ref_13","_ref_15","_ref_17","_ref_19","_ref_21"],"id":"directive-prologue","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"Directive Prologue"},{"type":"term","term":"Use Strict Directive","refId":"sec-directive-prologues-and-the-use-strict-directive","referencingIds":["_ref_3","_ref_7","_ref_9","_ref_12"],"id":"use-strict-directive","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"Use Strict Directive"},{"type":"term","term":"Hide Implementation Directive","refId":"sec-directive-prologues-and-the-use-strict-directive","referencingIds":["_ref_5","_ref_14","_ref_16","_ref_18","_ref_20","_ref_22"],"id":"hide-implementation-directive","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"Hide Implementation Directive"},{"type":"clause","id":"sec-directive-prologues-and-the-use-strict-directive","aoid":null,"title":"Directive Prologues and the Use Strict Directive","titleHTML":"Directive Prologues<del> and the Use Strict Directive</del>","number":"1","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Directive Prologues and the Use Strict Directive"},{"type":"term","term":"function implementation hidden code","refId":"sec-function-implementation-hidden-code","referencingIds":[],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"function implementation hidden code"},{"type":"clause","id":"sec-function-implementation-hidden-code","aoid":null,"title":"Function Implementation Hidden Code","titleHTML":"<ins>Function Implementation Hidden Code</ins>","number":"2","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":["_ref_26","_ref_30","_ref_35","_ref_40","_ref_43","_ref_49","_ref_57","_ref_63","_ref_69","_ref_74","_ref_81","_ref_86","_ref_92","_ref_96","_ref_100","_ref_106","_ref_110","_ref_115","_ref_119","_ref_121","_ref_127","_ref_131","_ref_134","_ref_139","_ref_144","_ref_148","_ref_154","_ref_162"],"key":"Function Implementation Hidden Code"},{"type":"production","id":"prod-FunctionDeclaration","name":"FunctionDeclaration","referencingIds":["_ref_163","_ref_176","_ref_178","_ref_179","_ref_181","_ref_183","_ref_184","_ref_185","_ref_200","_ref_203"],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"FunctionDeclaration"},{"type":"clause","id":"proposal-sec-function-definitions-runtime-semantics-instantiatefunctionobject","aoid":null,"title":"Runtime Semantics: InstantiateFunctionObject","titleHTML":"Runtime Semantics: InstantiateFunctionObject","number":"3","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Runtime Semantics: InstantiateFunctionObject"},{"type":"production","id":"prod-FunctionExpression","name":"FunctionExpression","referencingIds":["_ref_164","_ref_189","_ref_191","_ref_192","_ref_194","_ref_196","_ref_197","_ref_198","_ref_199","_ref_201","_ref_202","_ref_204"],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"FunctionExpression"},{"type":"production","id":"prod-FunctionStatementList","name":"FunctionStatementList","referencingIds":[],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"FunctionStatementList"},{"type":"clause","id":"proposal-sec-function-definitions-runtime-semantics-evaluation","aoid":null,"title":"Runtime Semantics: Evaluation","titleHTML":"Runtime Semantics: Evaluation","number":"4","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Runtime Semantics: Evaluation"},{"type":"production","id":"prod-ArrowFunction","name":"ArrowFunction","referencingIds":["_ref_172","_ref_205","_ref_206","_ref_207","_ref_208","_ref_209","_ref_210","_ref_211","_ref_212","_ref_213"],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"ArrowFunction"},{"type":"clause","id":"proposal-sec-arrow-function-definitions-runtime-semantics-evaluation","aoid":null,"title":"Runtime Semantics: Evaluation","titleHTML":"Runtime Semantics: Evaluation","number":"5","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Runtime Semantics: Evaluation"},{"type":"production","id":"prod-MethodDefinition","name":"MethodDefinition","referencingIds":["_ref_171","_ref_214","_ref_215","_ref_216","_ref_217","_ref_219","_ref_220","_ref_221","_ref_222","_ref_223","_ref_224"],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"MethodDefinition"},{"type":"clause","id":"proposal-sec-runtime-semantics-definemethod","aoid":null,"title":"Runtime Semantics: DefineMethod","titleHTML":"Runtime Semantics: DefineMethod","number":"6","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Runtime Semantics: DefineMethod"},{"type":"production","id":"prod-FormalParameters","name":"FormalParameters","referencingIds":["_ref_175","_ref_177","_ref_180","_ref_182","_ref_186","_ref_187","_ref_188","_ref_190","_ref_193","_ref_195","_ref_225","_ref_227","_ref_230","_ref_232","_ref_239","_ref_241","_ref_244","_ref_246","_ref_254","_ref_256","_ref_259","_ref_261","_ref_270","_ref_272","_ref_275","_ref_277","_ref_292","_ref_294","_ref_297","_ref_299","_ref_307","_ref_308","_ref_309","_ref_311","_ref_314","_ref_316","_ref_319","_ref_320","_ref_321","_ref_322"],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"FormalParameters"},{"type":"clause","id":"proposal-sec-method-definitions-runtime-semantics-propertydefinitionevaluation","aoid":null,"title":"Runtime Semantics: PropertyDefinitionEvaluation","titleHTML":"Runtime Semantics: PropertyDefinitionEvaluation","number":"7","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Runtime Semantics: PropertyDefinitionEvaluation"},{"type":"production","id":"prod-GeneratorDeclaration","name":"GeneratorDeclaration","referencingIds":["_ref_165","_ref_226","_ref_228","_ref_229","_ref_231","_ref_233","_ref_234","_ref_235","_ref_251"],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"GeneratorDeclaration"},{"type":"clause","id":"proposal-sec-generator-function-definitions-runtime-semantics-instantiatefunctionobject","aoid":null,"title":"Runtime Semantics: InstantiateFunctionObject","titleHTML":"Runtime Semantics: InstantiateFunctionObject","number":"8","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Runtime Semantics: InstantiateFunctionObject"},{"type":"production","id":"prod-GeneratorMethod","name":"GeneratorMethod","referencingIds":["_ref_218","_ref_236","_ref_237","_ref_238"],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"GeneratorMethod"},{"type":"clause","id":"proposal-sec-generator-function-definitions-runtime-semantics-propertydefinitionevaluation","aoid":null,"title":"Runtime Semantics: PropertyDefinitionEvaluation","titleHTML":"Runtime Semantics: PropertyDefinitionEvaluation","number":"9","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Runtime Semantics: PropertyDefinitionEvaluation"},{"type":"production","id":"prod-GeneratorExpression","name":"GeneratorExpression","referencingIds":["_ref_166","_ref_240","_ref_242","_ref_243","_ref_245","_ref_247","_ref_248","_ref_249","_ref_250","_ref_252","_ref_253"],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"GeneratorExpression"},{"type":"clause","id":"proposal-sec-generator-function-definitions-runtime-semantics-evaluation","aoid":null,"title":"Runtime Semantics: Evaluation","titleHTML":"Runtime Semantics: Evaluation","number":"10","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Runtime Semantics: Evaluation"},{"type":"production","id":"prod-AsyncGeneratorDeclaration","name":"AsyncGeneratorDeclaration","referencingIds":["_ref_169","_ref_255","_ref_257","_ref_258","_ref_260","_ref_262","_ref_263","_ref_264","_ref_282"],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"AsyncGeneratorDeclaration"},{"type":"clause","id":"proposal-sec-asyncgenerator-definitions-instantiatefunctionobject","aoid":null,"title":"Runtime Semantics: InstantiateFunctionObject","titleHTML":"Runtime Semantics: InstantiateFunctionObject","number":"11","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Runtime Semantics: InstantiateFunctionObject"},{"type":"production","id":"prod-AsyncGeneratorMethod","name":"AsyncGeneratorMethod","referencingIds":["_ref_266","_ref_268","_ref_269"],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"AsyncGeneratorMethod"},{"type":"clause","id":"proposal-sec-asyncgenerator-definitions-propertydefinitionevaluation","aoid":null,"title":"Runtime Semantics: PropertyDefinitionEvaluation","titleHTML":"Runtime Semantics: PropertyDefinitionEvaluation","number":"12","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Runtime Semantics: PropertyDefinitionEvaluation"},{"type":"production","id":"prod-AsyncGeneratorExpression","name":"AsyncGeneratorExpression","referencingIds":["_ref_170","_ref_271","_ref_273","_ref_274","_ref_276","_ref_278","_ref_279","_ref_280","_ref_281","_ref_283","_ref_284"],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"AsyncGeneratorExpression"},{"type":"clause","id":"proposal-sec-asyncgenerator-definitions-evaluation","aoid":null,"title":"Runtime Semantics: Evaluation","titleHTML":"Runtime Semantics: Evaluation","number":"13","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Runtime Semantics: Evaluation"},{"type":"production","id":"prod-ClassDeclaration","name":"ClassDeclaration","referencingIds":["_ref_173","_ref_285","_ref_286","_ref_287","_ref_288","_ref_289"],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"ClassDeclaration"},{"type":"clause","id":"proposal-sec-runtime-semantics-bindingclassdeclarationevaluation","aoid":null,"title":"Runtime Semantics: BindingClassDeclarationEvaluation","titleHTML":"Runtime Semantics: BindingClassDeclarationEvaluation","number":"14","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Runtime Semantics: BindingClassDeclarationEvaluation"},{"type":"production","id":"prod-ClassExpression","name":"ClassExpression","referencingIds":["_ref_174","_ref_290","_ref_291"],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"ClassExpression"},{"type":"clause","id":"proposal-sec-class-definitions-runtime-semantics-evaluation","aoid":null,"title":"Runtime Semantics: Evaluation","titleHTML":"Runtime Semantics: Evaluation","number":"15","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Runtime Semantics: Evaluation"},{"type":"production","id":"prod-AsyncFunctionDeclaration","name":"AsyncFunctionDeclaration","referencingIds":["_ref_167","_ref_293","_ref_295","_ref_296","_ref_298","_ref_300","_ref_301"],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"AsyncFunctionDeclaration"},{"type":"clause","id":"proposal-sec-async-function-definitions-InstantiateFunctionObject","aoid":null,"title":"Runtime Semantics: InstantiateFunctionObject","titleHTML":"Runtime Semantics: InstantiateFunctionObject","number":"16","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Runtime Semantics: InstantiateFunctionObject"},{"type":"production","id":"prod-AsyncMethod","name":"AsyncMethod","referencingIds":["_ref_303","_ref_305","_ref_306"],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"AsyncMethod"},{"type":"clause","id":"proposal-sec-async-function-definitions-PropertyDefinitionEvaluation","aoid":null,"title":"Runtime Semantics: PropertyDefinitionEvaluation","titleHTML":"Runtime Semantics: PropertyDefinitionEvaluation","number":"17","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Runtime Semantics: PropertyDefinitionEvaluation"},{"type":"production","id":"prod-AsyncFunctionExpression","name":"AsyncFunctionExpression","referencingIds":["_ref_168","_ref_310","_ref_312","_ref_313","_ref_315","_ref_317","_ref_318"],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"AsyncFunctionExpression"},{"type":"production","id":"prod-AwaitExpression","name":"AwaitExpression","referencingIds":["_ref_323"],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"AwaitExpression"},{"type":"clause","id":"proposal-sec-async-function-definitions-runtime-semantics-evaluation","aoid":null,"title":"Runtime Semantics: Evaluation","titleHTML":"Runtime Semantics: Evaluation","number":"18","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Runtime Semantics: Evaluation"},{"type":"production","id":"prod-UniqueFormalParameters","name":"UniqueFormalParameters","referencingIds":["_ref_265","_ref_267","_ref_302","_ref_304"],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"UniqueFormalParameters"},{"type":"table","id":"table-dynamic-function-sourcetext-prefixes","number":1,"caption":"Table 1: Dynamic Function SourceText Prefixes","referencingIds":["_ref_0"],"namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","key":"Table 1: Dynamic Function SourceText Prefixes"},{"type":"op","aoid":"CreateDynamicFunction","refId":"proposal-sec-createdynamicfunction","location":"","referencingIds":[],"key":"CreateDynamicFunction"},{"type":"clause","id":"proposal-sec-createdynamicfunction","aoid":"CreateDynamicFunction","title":"Runtime Semantics: CreateDynamicFunction( constructor, newTarget, kind, args )","titleHTML":"Runtime Semantics: CreateDynamicFunction( <var>constructor</var>, <var>newTarget</var>, <var>kind</var>, <var>args</var> )","number":"19","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Runtime Semantics: CreateDynamicFunction( constructor, newTarget, kind, args )"},{"type":"clause","id":"proposal-sec-forbidden-extensions","aoid":null,"title":"Forbidden Extensions","titleHTML":"Forbidden Extensions","number":"20","namespace":"https://domenic.github.io/proposal-function-implementation-hiding/","location":"","referencingIds":[],"key":"Forbidden Extensions"}]</script><script>"use strict";

function Search(menu) {
  this.menu = menu;
  this.$search = document.getElementById('menu-search');
  this.$searchBox = document.getElementById('menu-search-box');
  this.$searchResults = document.getElementById('menu-search-results');
  
  this.loadBiblio();
  
  document.addEventListener('keydown', this.documentKeydown.bind(this));
  
  this.$searchBox.addEventListener('keydown', debounce(this.searchBoxKeydown.bind(this), { stopPropagation: true }));
  this.$searchBox.addEventListener('keyup', debounce(this.searchBoxKeyup.bind(this), { stopPropagation: true }));
}

Search.prototype.loadBiblio = function () {
  var $biblio = document.getElementById('menu-search-biblio');
  if (!$biblio) {
    this.biblio = [];
  } else {
    this.biblio = JSON.parse($biblio.textContent);
    this.biblio.clauses = this.biblio.filter(function (e) { return e.type === 'clause' });
    this.biblio.byId = this.biblio.reduce(function (map, entry) {
      map[entry.id] = entry;
      return map;
    }, {});
  }
}

Search.prototype.documentKeydown = function (e) {
  if (e.keyCode === 191) {
    e.preventDefault();
    e.stopPropagation();
    this.triggerSearch();
  }
}

Search.prototype.searchBoxKeydown = function (e) {
  e.stopPropagation();
  e.preventDefault();
  if (e.keyCode === 191 && e.target.value.length === 0) {
    e.preventDefault();
  } else if (e.keyCode === 13) {
    e.preventDefault();
    this.selectResult();
  }
}

Search.prototype.searchBoxKeyup = function (e) {
  if (e.keyCode === 13 || e.keyCode === 9) {
    return;
  }
  
  this.search(e.target.value);
}


Search.prototype.triggerSearch = function (e) {
  if (this.menu.isVisible()) {
    this._closeAfterSearch = false;
  } else {
    this._closeAfterSearch = true;
    this.menu.show();
  }

  this.$searchBox.focus();
  this.$searchBox.select();
}
// bit 12 - Set if the result starts with searchString
// bits 8-11: 8 - number of chunks multiplied by 2 if cases match, otherwise 1.
// bits 1-7: 127 - length of the entry
// General scheme: prefer case sensitive matches with fewer chunks, and otherwise
// prefer shorter matches.
function relevance(result, searchString) {
  var relevance = 0;
  
  relevance = Math.max(0, 8 - result.match.chunks) << 7;
  
  if (result.match.caseMatch) {
    relevance *= 2;
  }
  
  if (result.match.prefix) {
    relevance += 2048
  }
  
  relevance += Math.max(0, 255 - result.entry.key.length);
  
  return relevance;
}

Search.prototype.search = function (searchString) {
  var s = Date.now();

  if (searchString === '') {
    this.displayResults([]);
    this.hideSearch();
    return;
  } else {
    this.showSearch();
  }
  
  if (searchString.length === 1) {
    this.displayResults([]);
    return;
  }
    
  var results;

  if (/^[\d\.]*$/.test(searchString)) {
    results = this.biblio.clauses.filter(function (clause) {
      return clause.number.substring(0, searchString.length) === searchString;
    }).map(function (clause) {
      return { entry: clause };
    });
  } else {
    results = [];
    
    for (var i = 0; i < this.biblio.length; i++) {
      var entry = this.biblio[i];
      if (!entry.key) {
        // biblio entries without a key aren't searchable
        continue;
      }

      var match = fuzzysearch(searchString, entry.key);
      if (match) {
        results.push({ entry: entry, match: match });
      }
    }
  
    results.forEach(function (result) {
      result.relevance = relevance(result, searchString);
    });
    
    results = results.sort(function (a, b) { return b.relevance - a.relevance });

  }

  if (results.length > 50) {
    results = results.slice(0, 50);
  }
  
  this.displayResults(results);
}
Search.prototype.hideSearch = function () {
  this.$search.classList.remove('active');
}

Search.prototype.showSearch = function () {
  this.$search.classList.add('active');
}

Search.prototype.selectResult = function () {
  var $first = this.$searchResults.querySelector('li:first-child a');

  if ($first) {
    document.location = $first.getAttribute('href');
  }
  
  this.$searchBox.value = '';
  this.$searchBox.blur();
  this.displayResults([]);
  this.hideSearch();

  if (this._closeAfterSearch) {
    this.menu.hide();
  }
}

Search.prototype.displayResults = function (results) {
  if (results.length > 0) {
    this.$searchResults.classList.remove('no-results');
    
    var html = '<ul>';

    results.forEach(function (result) {
      var entry = result.entry;
      var id = entry.id;
      var cssClass = '';
      var text = '';

      if (entry.type === 'clause') {
        var number = entry.number ? entry.number + ' ' : '';
        text = number + entry.key;
        cssClass = 'clause';
        id = entry.id;
      } else if (entry.type === 'production') {
        text = entry.key;
        cssClass = 'prod';
        id = entry.id;  
      } else if (entry.type === 'op') {
        text = entry.key;
        cssClass = 'op';
        id = entry.id || entry.refId;
      } else if (entry.type === 'term') {
        text = entry.key;
        cssClass = 'term';
        id = entry.id || entry.refId;
      }

      if (text) {
        html += '<li class=menu-search-result-' + cssClass + '><a href="#' + id + '">' + text + '</a></li>'
      }
    });

    html += '</ul>'

    this.$searchResults.innerHTML = html;
  } else {
    this.$searchResults.innerHTML = '';
    this.$searchResults.classList.add('no-results');
  }
}


function Menu() {
  this.$toggle = document.getElementById('menu-toggle');
  this.$menu = document.getElementById('menu');
  this.$toc = document.querySelector('menu-toc > ol');
  this.$pins = document.querySelector('#menu-pins');
  this.$pinList = document.getElementById('menu-pins-list');
  this.$toc = document.querySelector('#menu-toc > ol');
  this.$specContainer = document.getElementById('spec-container');
  this.search = new Search(this);
  
  this._pinnedIds = {}; 
  this.loadPinEntries();

  // toggle menu
  this.$toggle.addEventListener('click', this.toggle.bind(this));

  // keydown events for pinned clauses
  document.addEventListener('keydown', this.documentKeydown.bind(this));

  // toc expansion
  var tocItems = this.$menu.querySelectorAll('#menu-toc li');
  for (var i = 0; i < tocItems.length; i++) {
    var $item = tocItems[i];
    $item.addEventListener('click', function($item, event) {
      $item.classList.toggle('active');
      event.stopPropagation();
    }.bind(null, $item));
  }

  // close toc on toc item selection
  var tocLinks = this.$menu.querySelectorAll('#menu-toc li > a');
  for (var i = 0; i < tocLinks.length; i++) {
    var $link = tocLinks[i];
    $link.addEventListener('click', function(event) {
      this.toggle();
      event.stopPropagation();
    }.bind(this));
  }

  // update active clause on scroll
  window.addEventListener('scroll', debounce(this.updateActiveClause.bind(this)));
  this.updateActiveClause();

  // prevent menu scrolling from scrolling the body
  this.$toc.addEventListener('wheel', function (e) {
    var target = e.currentTarget;
    var offTop = e.deltaY < 0 && target.scrollTop === 0;
    if (offTop) {
      e.preventDefault();
    }
    var offBottom = e.deltaY > 0
                    && target.offsetHeight + target.scrollTop >= target.scrollHeight;

    if (offBottom) {
		  e.preventDefault();
	  }
  })
}

Menu.prototype.documentKeydown = function (e) {
  e.stopPropagation();
  if (e.keyCode === 80) {
    this.togglePinEntry();
  } else if (e.keyCode > 48 && e.keyCode < 58) {
    this.selectPin(e.keyCode - 49);
  }
}

Menu.prototype.updateActiveClause = function () {
  this.setActiveClause(findActiveClause(this.$specContainer))
}

Menu.prototype.setActiveClause = function (clause) {
  this.$activeClause = clause;
  this.revealInToc(this.$activeClause);
}

Menu.prototype.revealInToc = function (path) {
  var current = this.$toc.querySelectorAll('li.revealed');
  for (var i = 0; i < current.length; i++) {
    current[i].classList.remove('revealed');
    current[i].classList.remove('revealed-leaf');
  }
  
  var current = this.$toc;
  var index = 0;
  while (index < path.length) {
    var children = current.children;
    for (var i = 0; i < children.length; i++) {
      if ('#' + path[index].id === children[i].children[1].getAttribute('href') ) {
        children[i].classList.add('revealed');
        if (index === path.length - 1) {
          children[i].classList.add('revealed-leaf');
          var rect = children[i].getBoundingClientRect();
          this.$toc.getBoundingClientRect().top
          var tocRect = this.$toc.getBoundingClientRect();
          if (rect.top + 10 > tocRect.bottom) {
            this.$toc.scrollTop = this.$toc.scrollTop + (rect.top - tocRect.bottom) + (rect.bottom - rect.top);
          } else if (rect.top < tocRect.top) {
            this.$toc.scrollTop = this.$toc.scrollTop - (tocRect.top - rect.top);
          }
        }
        current = children[i].querySelector('ol');
        index++;
        break;
      }      
    }
    
  }
}

function findActiveClause(root, path) {
  var clauses = new ClauseWalker(root);
  var $clause;
  var found = false;
  var path = path || [];
  
  while ($clause = clauses.nextNode()) {
    var rect = $clause.getBoundingClientRect();
    var $header = $clause.children[0];
    var marginTop = parseInt(getComputedStyle($header)["margin-top"]);
    
    if ((rect.top - marginTop) <= 0 && rect.bottom > 0) {
      found = true;
      return findActiveClause($clause, path.concat($clause)) || path;
    }
  }
  
  return path;
}

function ClauseWalker(root) {
  var previous;
  var treeWalker = document.createTreeWalker(
    root,
    NodeFilter.SHOW_ELEMENT,
    {
      acceptNode: function (node) {
        if (previous === node.parentNode) {
          return NodeFilter.FILTER_REJECT;
        } else {
          previous = node;
        }
        if (node.nodeName === 'EMU-CLAUSE' || node.nodeName === 'EMU-INTRO' || node.nodeName === 'EMU-ANNEX') {
          return NodeFilter.FILTER_ACCEPT;
        } else {
          return NodeFilter.FILTER_SKIP;
        }
      }
    },
    false
    );
  
  return treeWalker;
}

Menu.prototype.toggle = function () {
  this.$menu.classList.toggle('active');
}

Menu.prototype.show = function () {
  this.$menu.classList.add('active');
}

Menu.prototype.hide = function () {
  this.$menu.classList.remove('active');
}

Menu.prototype.isVisible = function() {
  return this.$menu.classList.contains('active');
}

Menu.prototype.showPins = function () {
  this.$pins.classList.add('active');
}

Menu.prototype.hidePins = function () {
  this.$pins.classList.remove('active');
}

Menu.prototype.addPinEntry = function (id) {
  var entry = this.search.biblio.byId[id];
  if (!entry) {
    // id was deleted after pin (or something) so remove it
    delete this._pinnedIds[id];
    this.persistPinEntries();
    return;
  }

  if (entry.type === 'clause') {
    var prefix;
    if (entry.number) {
      prefix = entry.number + ' ';
    } else {
      prefix = '';
    }
    this.$pinList.innerHTML += '<li><a href="#' + entry.id + '">' + prefix + entry.titleHTML + '</a></li>';
  } else {
    this.$pinList.innerHTML += '<li><a href="#' + entry.id + '">' + entry.key + '</a></li>';
  }

  if (Object.keys(this._pinnedIds).length === 0) {
    this.showPins();
  }
  this._pinnedIds[id] = true;
  this.persistPinEntries();
}

Menu.prototype.removePinEntry = function (id) {
  var item = this.$pinList.querySelector('a[href="#' + id + '"]').parentNode;
  this.$pinList.removeChild(item);
  delete this._pinnedIds[id];
  if (Object.keys(this._pinnedIds).length === 0) {
    this.hidePins();
  }

  this.persistPinEntries();
}

Menu.prototype.persistPinEntries = function () {
  try {
    if (!window.localStorage) return;
  } catch (e) {
    return;
  }

  localStorage.pinEntries = JSON.stringify(Object.keys(this._pinnedIds));
}

Menu.prototype.loadPinEntries = function () {
  try {
    if (!window.localStorage) return;
  } catch (e) {
    return;
  }
  
  var pinsString = window.localStorage.pinEntries;
  if (!pinsString) return;
  var pins = JSON.parse(pinsString);
  for(var i = 0; i < pins.length; i++) {
    this.addPinEntry(pins[i]);
  }
}

Menu.prototype.togglePinEntry = function (id) {
  if (!id) {
    id = this.$activeClause[this.$activeClause.length - 1].id;
  }

  if (this._pinnedIds[id]) {
    this.removePinEntry(id);
  } else {
    this.addPinEntry(id);
  }
}

Menu.prototype.selectPin = function (num) {
  document.location = this.$pinList.children[num].children[0].href;
}

var menu;
function init() {
  menu = new Menu();
  var $container = document.getElementById('spec-container');
  $container.addEventListener('mouseover', debounce(function (e) {
    Toolbox.activateIfMouseOver(e);
  }));
}

document.addEventListener('DOMContentLoaded', init);

function debounce(fn, opts) {
  opts = opts || {};
  var timeout;
  return function(e) {
    if (opts.stopPropagation) {
      e.stopPropagation();
    }
    var args = arguments;
    if (timeout) {
      clearTimeout(timeout);
    }
    timeout = setTimeout(function() {
      timeout = null;
      fn.apply(this, args);
    }.bind(this), 150);
  }
}

var CLAUSE_NODES = ['EMU-CLAUSE', 'EMU-INTRO', 'EMU-ANNEX'];
function findLocalReferences ($elem) {
  var name = $elem.innerHTML;
  var references = [];

  var parentClause = $elem.parentNode;
  while (parentClause && CLAUSE_NODES.indexOf(parentClause.nodeName) === -1) {
    parentClause = parentClause.parentNode;
  }

  if(!parentClause) return;

  var vars = parentClause.querySelectorAll('var');

  for (var i = 0; i < vars.length; i++) {
    var $var = vars[i];

    if ($var.innerHTML === name) {
      references.push($var);
    }
  }

  return references;
}

function toggleFindLocalReferences($elem) {
  var references = findLocalReferences($elem);
  if ($elem.classList.contains('referenced')) {
    references.forEach(function ($reference) {
      $reference.classList.remove('referenced');
    });
  } else {
    references.forEach(function ($reference) {
      $reference.classList.add('referenced');
    });
  }
}

function installFindLocalReferences () {
  document.addEventListener('click', function (e) {
    if (e.target.nodeName === 'VAR') {
      toggleFindLocalReferences(e.target);
    }
  });
}

document.addEventListener('DOMContentLoaded', installFindLocalReferences);




// The following license applies to the fuzzysearch function
// The MIT License (MIT)
// Copyright © 2015 Nicolas Bevacqua
// Copyright © 2016 Brian Terlson
// Permission is hereby granted, free of charge, to any person obtaining a copy of
// this software and associated documentation files (the "Software"), to deal in
// the Software without restriction, including without limitation the rights to
// use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
// the Software, and to permit persons to whom the Software is furnished to do so,
// subject to the following conditions:

// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.

// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
// FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
// COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
// IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
// CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
function fuzzysearch (searchString, haystack, caseInsensitive) {
  var tlen = haystack.length;
  var qlen = searchString.length;
  var chunks = 1;
  var finding = false;
  var prefix = true;
  
  if (qlen > tlen) {
    return false;
  }
  
  if (qlen === tlen) {
    if (searchString === haystack) {
      return { caseMatch: true, chunks: 1, prefix: true };
    } else if (searchString.toLowerCase() === haystack.toLowerCase()) {
      return { caseMatch: false, chunks: 1, prefix: true };
    } else {
      return false;
    }
  }
  
  outer: for (var i = 0, j = 0; i < qlen; i++) {
    var nch = searchString[i];
    while (j < tlen) {
      var targetChar = haystack[j++];
      if (targetChar === nch) {
        finding = true;
        continue outer;
      }
      if (finding) {
        chunks++;
        finding = false;
      }
    }
    
    if (caseInsensitive) { return false }
    
    return fuzzysearch(searchString.toLowerCase(), haystack.toLowerCase(), true);
  }
  
  return { caseMatch: !caseInsensitive, chunks: chunks, prefix: j <= qlen };
}

var Toolbox = {
  init: function () {
    this.$container = document.createElement('div');
    this.$container.classList.add('toolbox');
    this.$permalink = document.createElement('a');
    this.$permalink.textContent = 'Permalink';
    this.$pinLink = document.createElement('a');
    this.$pinLink.textContent = 'Pin';
    this.$pinLink.setAttribute('href', '#');
    this.$pinLink.addEventListener('click', function (e) {
      e.preventDefault();
      e.stopPropagation();
      menu.togglePinEntry(this.entry.id);
    }.bind(this));

    this.$refsLink = document.createElement('a');
    this.$refsLink.setAttribute('href', '#');
    this.$refsLink.addEventListener('click', function (e) {
      e.preventDefault();
      e.stopPropagation();
      referencePane.showReferencesFor(this.entry);
    }.bind(this));
    this.$container.appendChild(this.$permalink);
    this.$container.appendChild(this.$pinLink);
    this.$container.appendChild(this.$refsLink);
    document.body.appendChild(this.$container);
  },

  activate: function (el, entry, target) {
    if (el === this._activeEl) return;
    this.active = true;
    this.entry = entry;
    this.$container.classList.add('active');
    this.top = el.offsetTop - this.$container.offsetHeight - 10;
    this.left = el.offsetLeft;
    this.$container.setAttribute('style', 'left: ' + this.left + 'px; top: ' + this.top + 'px');
    this.updatePermalink();
    this.updateReferences();
    this._activeEl = el;
    if (this.top < document.body.scrollTop && el === target) {
      // don't scroll unless it's a small thing (< 200px)
      this.$container.scrollIntoView();
    }
  },

  updatePermalink: function () {
    this.$permalink.setAttribute('href', '#' + this.entry.id);
  },

  updateReferences: function () {
    this.$refsLink.textContent = 'References (' + this.entry.referencingIds.length + ')';
  },

  activateIfMouseOver: function (e) {
    var ref = this.findReferenceUnder(e.target);
    if (ref && (!this.active || e.pageY > this._activeEl.offsetTop)) {
      var entry = menu.search.biblio.byId[ref.id];
      this.activate(ref.element, entry, e.target);
    } else if (this.active && ((e.pageY < this.top) || e.pageY > (this._activeEl.offsetTop + this._activeEl.offsetHeight))) {
      this.deactivate();
    }
  },

  findReferenceUnder: function (el) {
    while (el) {
      var parent = el.parentNode;
      if (el.nodeName === 'H1' && parent.nodeName.match(/EMU-CLAUSE|EMU-ANNEX|EMU-INTRO/) && parent.id) {
        return { element: el, id: parent.id };
      } else if (el.nodeName.match(/EMU-(?!CLAUSE|XREF|ANNEX|INTRO)|DFN/) &&
                el.id && el.id[0] !== '_') {
        if (el.nodeName === 'EMU-FIGURE' || el.nodeName === 'EMU-TABLE' || el.nodeName === 'EMU-EXAMPLE') {
          // return the figcaption element
          return { element: el.children[0].children[0], id: el.id };
        } else if (el.nodeName === 'EMU-PRODUCTION') {
          // return the LHS non-terminal element
          return { element: el.children[0], id: el.id };
        } else {
          return { element: el, id: el.id };
        }
      }
      el = parent;
    }
  },

  deactivate: function () {
    this.$container.classList.remove('active');
    this._activeEl = null;
    this.activeElBounds = null;
    this.active = false;
  }
}

var referencePane = {
  init: function() {
    this.$container = document.createElement('div');
    this.$container.setAttribute('id', 'references-pane-container');

    var $spacer = document.createElement('div');
    $spacer.setAttribute('id', 'references-pane-spacer');

    this.$pane = document.createElement('div');
    this.$pane.setAttribute('id', 'references-pane');

    this.$container.appendChild($spacer);
    this.$container.appendChild(this.$pane);

    this.$header = document.createElement('div');
    this.$header.classList.add('menu-pane-header');
    this.$header.textContent = 'References to ';
    this.$headerRefId = document.createElement('a');
    this.$header.appendChild(this.$headerRefId);
    this.$closeButton = document.createElement('span');
    this.$closeButton.setAttribute('id', 'references-pane-close');
    this.$closeButton.addEventListener('click', function (e) {
      this.deactivate();
    }.bind(this));
    this.$header.appendChild(this.$closeButton);

    this.$pane.appendChild(this.$header);
    var tableContainer = document.createElement('div');
    tableContainer.setAttribute('id', 'references-pane-table-container');

    this.$table = document.createElement('table');
    this.$table.setAttribute('id', 'references-pane-table');

    this.$tableBody = this.$table.createTBody();

    tableContainer.appendChild(this.$table);
    this.$pane.appendChild(tableContainer);

    menu.$specContainer.appendChild(this.$container);
  },

  activate: function () {
    this.$container.classList.add('active');
  },

  deactivate: function () {
    this.$container.classList.remove('active');
  },

  showReferencesFor(entry) {
    this.activate();
    var newBody = document.createElement('tbody');
    var previousId;
    var previousCell;
    var dupCount = 0;
    this.$headerRefId.textContent = '#' + entry.id;
    this.$headerRefId.setAttribute('href', '#' + entry.id);
    entry.referencingIds.map(function (id) {
      var target = document.getElementById(id);
      var cid = findParentClauseId(target);
      var clause = menu.search.biblio.byId[cid];
      var dupCount = 0;
      return { id: id, clause: clause }
    }).sort(function (a, b) {
      return sortByClauseNumber(a.clause, b.clause);
    }).forEach(function (record, i) {
      if (previousId === record.clause.id) {
        previousCell.innerHTML += ' (<a href="#' + record.id + '">' + (dupCount + 2) + '</a>)';
        dupCount++;
      } else {
        var row = newBody.insertRow();
        var cell = row.insertCell();
        cell.innerHTML = record.clause.number;
        cell = row.insertCell();
        cell.innerHTML = '<a href="#' + record.id + '">' + record.clause.titleHTML + '</a>';
        previousCell = cell;
        previousId = record.clause.id;
        dupCount = 0;
      }
    }, this);
    this.$table.removeChild(this.$tableBody);
    this.$tableBody = newBody;
    this.$table.appendChild(this.$tableBody);
  }
}
function findParentClauseId(node) {
  while (node && node.nodeName !== 'EMU-CLAUSE' && node.nodeName !== 'EMU-INTRO' && node.nodeName !== 'EMU-ANNEX') {
    node = node.parentNode;
  }
  if (!node) return null;
  return node.getAttribute('id');
}

function sortByClauseNumber(c1, c2) {
  var c1c = c1.number.split('.');
  var c2c = c2.number.split('.');

  for (var i = 0; i < c1c.length; i++) {
    if (i >= c2c.length) {
      return 1;
    }
    
    var c1 = c1c[i];
    var c2 = c2c[i];
    var c1cn = Number(c1);
    var c2cn = Number(c2);

    if (Number.isNaN(c1cn) && Number.isNaN(c2cn)) {
      if (c1 > c2) {
        return 1;
      } else if (c1 < c2) {
        return -1;
      }
    } else if (!Number.isNaN(c1cn) && Number.isNaN(c2cn)) {
      return -1;
    } else if (Number.isNaN(c1cn) && !Number.isNaN(c2cn)) {
      return 1;
    } else if(c1cn > c2cn) {
      return 1;
    } else if (c1cn < c2cn) {
      return -1;
    }
  }

  if (c1c.length === c2c.length) {
    return 0;
  }
  return -1;
}

document.addEventListener('DOMContentLoaded', function () {
  Toolbox.init();
  referencePane.init();
})
var CLAUSE_NODES = ['EMU-CLAUSE', 'EMU-INTRO', 'EMU-ANNEX'];
function findLocalReferences ($elem) {
  var name = $elem.innerHTML;
  var references = [];

  var parentClause = $elem.parentNode;
  while (parentClause && CLAUSE_NODES.indexOf(parentClause.nodeName) === -1) {
    parentClause = parentClause.parentNode;
  }

  if(!parentClause) return;

  var vars = parentClause.querySelectorAll('var');

  for (var i = 0; i < vars.length; i++) {
    var $var = vars[i];

    if ($var.innerHTML === name) {
      references.push($var);
    }
  }

  return references;
}

function toggleFindLocalReferences($elem) {
  var references = findLocalReferences($elem);
  if ($elem.classList.contains('referenced')) {
    references.forEach(function ($reference) {
      $reference.classList.remove('referenced');
    });
  } else {
    references.forEach(function ($reference) {
      $reference.classList.add('referenced');
    });
  }
}

function installFindLocalReferences () {
  document.addEventListener('click', function (e) {
    if (e.target.nodeName === 'VAR') {
      toggleFindLocalReferences(e.target);
    }
  });
}

document.addEventListener('DOMContentLoaded', installFindLocalReferences);
</script><style>body {
  display: flex;
  font-size: 18px;
  line-height: 1.5;
  font-family: Cambria, Palatino Linotype, Palatino, Liberation Serif, serif;
  padding: 0;
  margin: 0;
  color: #111;
}

#spec-container {
  padding: 0 20px;
  flex-grow: 1;
  flex-basis: 66%;
  box-sizing: border-box;
  overflow: hidden;
}

body.oldtoc {
  margin: 0 auto;
}

a {
    text-decoration: none;
    color: #206ca7;
}

a:visited {
  color: #206ca7;
}

a:hover {
    text-decoration: underline;
    color: #239dee;
}


code {
    font-weight: bold;
    font-family: Consolas, Monaco, monospace;
    white-space: pre;
}

pre code {
  font-weight: inherit;
}

pre code.hljs {
  background-color: #fff;
  margin: 0;
  padding: 0;
}

ol.toc {
    list-style: none;
    padding-left: 0;
}

ol.toc ol.toc {
    padding-left: 2ex;
    list-style: none;
}

var {
  color: #2aa198;
  transition: background-color 0.25s ease;
  cursor: pointer;
}

var.referenced {
  background-color: #ffff33;
}

emu-const {
  font-family: sans-serif;
}

emu-val {
  font-weight: bold;
}
emu-alg ol, emu-alg ol ol ol ol {
    list-style-type: decimal;
}

emu-alg ol ol, emu-alg ol ol ol ol ol {
    list-style-type: lower-alpha;
}

emu-alg ol ol ol, ol ol ol ol ol ol {
    list-style-type: lower-roman;
}

emu-eqn {
  display: block;
  margin-left: 4em;
}

emu-eqn.inline {
  display: inline;
  margin: 0;
}

emu-eqn div:first-child {
  margin-left: -2em;
}

emu-note {
    margin: 1em 0;
    color: #666;
    border-left: 5px solid #ccc;
    display: flex;
    flex-direction: row;
}

emu-note > span.note {
    flex-basis: 100px;
    min-width: 100px;
    flex-grow: 0;
    flex-shrink: 1;
    text-transform: uppercase;
    padding-left: 5px;
}

emu-note[type=editor] {
  border-left-color: #faa;
}

emu-note > div.note-contents {
  flex-grow: 1;
  flex-shrink: 1;
}

emu-note > div.note-contents > p:first-of-type {
  margin-top: 0;
}

emu-note > div.note-contents > p:last-of-type {
  margin-bottom: 0;
}

emu-figure {
  display: block;
}

emu-example {
  display: block;
  margin: 1em 3em;
}

emu-example figure figcaption {
  margin-top: 0.5em;
  text-align: left;
}

emu-figure figure,
emu-example figure,
emu-table figure {
  display: flex;
  flex-direction: column;
  align-items: center;
}

emu-production {
    display: block;
    margin-top: 1em;
    margin-bottom: 1em;
    margin-left: 5ex;
}

emu-grammar.inline, emu-production.inline,
emu-grammar.inline emu-production emu-rhs, emu-production.inline emu-rhs,
emu-grammar[collapsed] emu-production emu-rhs, emu-production[collapsed] emu-rhs {
    display: inline;
    padding-left: 1ex;
    margin-left: 0;
}

emu-grammar[collapsed] emu-production, emu-production[collapsed] {
    margin: 0;
}

emu-constraints {
    font-size: .75em;
    margin-right: 1ex;
}

emu-gann {
    margin-right: 1ex;
}

emu-gann emu-t:last-child,
emu-gann emu-nt:last-child {
    margin-right: 0;
}

emu-geq {
    margin-left: 1ex;
    font-weight: bold;
}

emu-oneof {
    font-weight: bold;
    margin-left: 1ex;
}

emu-nt {
    display: inline-block;
    font-style: italic;
    white-space: nowrap;
    text-indent: 0;
}

emu-nt a, emu-nt a:visited {
  color: #333;
}

emu-rhs emu-nt {
    margin-right: 1ex;
}

emu-t {
    display: inline-block;
    font-family: monospace;
    font-weight: bold;
    white-space: nowrap;
    text-indent: 0;
}

emu-production emu-t {
    margin-right: 1ex;
}

emu-rhs {
    display: block;
    padding-left: 75px;
    text-indent: -25px;
}

emu-mods {
    font-size: .85em;
    vertical-align: sub;
    font-style: normal;
    font-weight: normal;
}

emu-production[collapsed] emu-mods {
  display: none;
}

emu-params, emu-opt {
  margin-right: 1ex;
  font-family: monospace;
}

emu-params, emu-constraints {
  color: #2aa198;
}

emu-opt {
  color: #b58900;
}

emu-gprose {
    font-size: 0.9em;
    font-family: Helvetica, Arial, sans-serif;
}

h1.shortname {
  color: #f60;
  font-size: 1.5em;
  margin: 0;
}

h1.version {
  color: #f60;
  font-size: 1.5em;
  margin: 0;
}

h1.title {
  margin-top: 0;
  color: #f60;
}

h1.first {
  margin-top: 0;
}

h1, h2, h3, h4, h5, h6 {
    position: relative;
}

h1 .secnum {
  text-decoration: none;
  margin-right: 10px;
}

h1 span.title {
  order: 2;
}


h1 { font-size: 2.67em; margin-top: 2em; margin-bottom: 0; line-height: 1em;}
h2 { font-size: 2em; }
h3 { font-size: 1.56em; }
h4 { font-size: 1.25em; }
h5 { font-size: 1.11em; }
h6 { font-size: 1em; }

h1:hover span.utils {
  display: block;
}

span.utils {
  font-size: 18px;
  line-height: 18px;
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  font-weight: normal;
}

span.utils:before {
    content: "⤷";
    display: inline-block;
    padding: 0 5px;
}

span.utils > * {
  display: inline-block;
  margin-right: 20px;
}

h1 span.utils span.anchor a,
h2 span.utils span.anchor a,
h3 span.utils span.anchor a,
h4 span.utils span.anchor a,
h5 span.utils span.anchor a,
h6 span.utils span.anchor a {
  text-decoration: none;
  font-variant: small-caps;
}

h1 span.utils span.anchor a:hover,
h2 span.utils span.anchor a:hover,
h3 span.utils span.anchor a:hover,
h4 span.utils span.anchor a:hover,
h5 span.utils span.anchor a:hover,
h6 span.utils span.anchor a:hover {
  color: #333;
}

emu-intro h1, emu-clause h1, emu-annex h1 { font-size: 2em; }
emu-intro h2, emu-clause h2, emu-annex h2 { font-size: 1.56em; }
emu-intro h3, emu-clause h3, emu-annex h3 { font-size: 1.25em; }
emu-intro h4, emu-clause h4, emu-annex h4 { font-size: 1.11em; }
emu-intro h5, emu-clause h5, emu-annex h5 { font-size: 1em; }
emu-intro h6, emu-clause h6, emu-annex h6 { font-size: 0.9em; }
emu-intro emu-intro h1, emu-clause emu-clause h1, emu-annex emu-annex h1 { font-size: 1.56em; }
emu-intro emu-intro h2, emu-clause emu-clause h2, emu-annex emu-annex h2 { font-size: 1.25em; }
emu-intro emu-intro h3, emu-clause emu-clause h3, emu-annex emu-annex h3 { font-size: 1.11em; }
emu-intro emu-intro h4, emu-clause emu-clause h4, emu-annex emu-annex h4 { font-size: 1em; }
emu-intro emu-intro h5, emu-clause emu-clause h5, emu-annex emu-annex h5 { font-size: 0.9em; }
emu-intro emu-intro emu-intro h1, emu-clause emu-clause emu-clause h1, emu-annex emu-annex emu-annex h1 { font-size: 1.25em; }
emu-intro emu-intro emu-intro h2, emu-clause emu-clause emu-clause h2, emu-annex emu-annex emu-annex h2 { font-size: 1.11em; }
emu-intro emu-intro emu-intro h3, emu-clause emu-clause emu-clause h3, emu-annex emu-annex emu-annex h3 { font-size: 1em; }
emu-intro emu-intro emu-intro h4, emu-clause emu-clause emu-clause h4, emu-annex emu-annex emu-annex h4 { font-size: 0.9em; }
emu-intro emu-intro emu-intro emu-intro h1, emu-clause emu-clause emu-clause emu-clause h1, emu-annex emu-annex emu-annex emu-annex h1 { font-size: 1.11em; }
emu-intro emu-intro emu-intro emu-intro h2, emu-clause emu-clause emu-clause emu-clause h2, emu-annex emu-annex emu-annex emu-annex h2 { font-size: 1em; }
emu-intro emu-intro emu-intro emu-intro h3, emu-clause emu-clause emu-clause emu-clause h3, emu-annex emu-annex emu-annex emu-annex h3 { font-size: 0.9em; }
emu-intro emu-intro emu-intro emu-intro emu-intro h1, emu-clause emu-clause emu-clause emu-clause emu-clause h1, emu-annex emu-annex emu-annex emu-annex emu-annex h1 { font-size: 1em; }
emu-intro emu-intro emu-intro emu-intro emu-intro h2, emu-clause emu-clause emu-clause emu-clause emu-clause h2, emu-annex emu-annex emu-annex emu-annex emu-annex h2 { font-size: 0.9em; }
emu-intro emu-intro emu-intro emu-intro emu-intro emu-intro h1, emu-clause emu-clause emu-clause emu-clause emu-clause emu-clause h1, emu-annex emu-annex emu-annex emu-annex emu-annex emu-annex h1 { font-size: 0.9em }

emu-clause, emu-intro, emu-annex {
    display: block;
}

/* Figures and tables */
figure { display: block; margin: 1em 0 3em 0; }
figure object { display: block; margin: 0 auto; }
figure table.real-table { margin: 0 auto; }
figure figcaption {
    display: block;
    color: #555555;
    font-weight: bold;
    text-align: center;
}

emu-table table {
  margin: 0 auto;
}

emu-table table, table.real-table {
    border-collapse: collapse;
}

emu-table td, emu-table th, table.real-table td, table.real-table th {
    border: 1px solid black;
    padding: 0.4em;
    vertical-align: baseline;
}
emu-table th, emu-table thead td, table.real-table th {
    background-color: #eeeeee;
}

/* Note: the left content edges of table.lightweight-table >tbody >tr >td
   and div.display line up. */
table.lightweight-table {
    border-collapse: collapse;
    margin: 0 0 0 1.5em;
}
table.lightweight-table td, table.lightweight-table th {
    border: none;
    padding: 0 0.5em;
    vertical-align: baseline;
}

/* diff styles */
ins {
    background-color: #e0f8e0;
    text-decoration: none;
    border-bottom: 1px solid #396;
}

del {
    background-color: #fee;
}

ins.block, del.block,
emu-production > ins, emu-production > del,
emu-grammar > ins, emu-grammar > del {
  display: block;
}
emu-rhs > ins, emu-rhs > del { 
  display: inline;
}

tr.ins > td > ins {
  border-bottom: none;
}

tr.ins > td {
  background-color: #e0f8e0;
}

tr.del > td {
  background-color: #fee;
}

/* Menu Styles */
#menu-toggle {
  font-size: 2em;

  position: fixed;
  top: 0;
  left: 0;
  width: 1.5em;
  height: 1.5em;
  z-index: 3;
  visibility: hidden;
  color: #1567a2;
  background-color: #fff;

  line-height: 1.5em;
  text-align: center;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;;

  cursor: pointer;
}

#menu {
  display: flex;
  flex-direction: column;
  width: 33%; height: 100vh;
  max-width: 500px;
  box-sizing: border-box;
  background-color: #ddd;
  overflow: hidden;
  transition: opacity 0.1s linear;
  padding: 0 5px;
  position: fixed;
  left: 0; top: 0;
  border-right: 2px solid #bbb;

  z-index: 2;
}

#menu-spacer {
  flex-basis: 33%;
  max-width: 500px;
  flex-grow: 0;
  flex-shrink: 0;
}

#menu a {
  color: #1567a2;
}

#menu.active {
  display: flex;
  opacity: 1;
  z-index: 2;
}

#menu-pins {
  flex-grow: 1;
  display: none;
}

#menu-pins.active {
  display: block;
}

#menu-pins-list {
  margin: 0;
  padding: 0;
  counter-reset: pins-counter;
}

#menu-pins-list > li:before {
  content: counter(pins-counter);
  counter-increment: pins-counter;
  display: inline-block;
  width: 25px;
  text-align: center;
  border: 1px solid #bbb;
  padding: 2px;
  margin: 4px;
  box-sizing: border-box;
  line-height: 1em;
  background-color: #ccc;
  border-radius: 4px;
}
#menu-toc > ol {
  padding: 0;
  flex-grow: 1;
}

#menu-toc > ol li {
  padding: 0;
}

#menu-toc > ol , #menu-toc > ol ol {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

#menu-toc > ol ol {
  padding-left: 0.75em;
}

#menu-toc li {
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
}

#menu-toc .item-toggle {
  display: inline-block;
  transform: rotate(-45deg) translate(-5px, -5px);
  transition: transform 0.1s ease;
  text-align: center;
  width: 20px;

  color: #aab;

  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;;

  cursor: pointer;
}

#menu-toc .item-toggle-none {
  display: inline-block;
  width: 20px;
}

#menu-toc li.active > .item-toggle {
  transform: rotate(45deg) translate(-5px, -5px);
}

#menu-toc li > ol {
  display: none;
}

#menu-toc li.active > ol {
  display: block;
}

#menu-toc li.revealed > a {
  background-color: #bbb;
  font-weight: bold;
  /*
  background-color: #222;
  color: #c6d8e4;
  */
}

#menu-toc li.revealed-leaf> a {
  color: #206ca7;
  /*
  background-color: #222;
  color: #c6d8e4;
  */
}

#menu-toc li.revealed > .item-toggle {
  transform: rotate(45deg) translate(-5px, -5px);
}

#menu-toc li.revealed > ol {
  display: block;
}

#menu-toc li > a {
  padding: 2px 5px;
}

#menu > * {
  margin-bottom: 5px;
}

.menu-pane-header {
  padding: 0 5px;
  text-transform: uppercase;
  background-color: #aaa;
  color: #335;
  font-weight: bold;
  letter-spacing: 2px;
  flex-grow: 0;
  flex-shrink: 0;
  font-size: 0.8em;
}

#menu-toc {
  display: flex;
  flex-direction: column;
  width: 100%;
  overflow: hidden;
  flex-grow: 1;
}

#menu-toc ol.toc {
  overflow-x: hidden;
  overflow-y: auto;
}

#menu-search {
  position: relative;
  flex-grow: 0;
  flex-shrink: 0;
  width: 100%;
  
  display: flex;
  flex-direction: column;
  
  max-height: 300px;
}

#menu-trace-list {
  display: none;
}

#menu-search-box {
  box-sizing: border-box;
  display: block;
  width: 100%;
  margin: 5px 0 0 0;
  font-size: 1em;
  padding: 2px;
  background-color: #bbb;
  border: 1px solid #999;
}

#menu-search-results {
  overflow-x: hidden;
  overflow-y: auto;
}

li.menu-search-result-clause:before {
    content: 'clause';
    width: 40px;
    display: inline-block;
    text-align: right;
    padding-right: 1ex;
    color: #666;
    font-size: 75%;
}
li.menu-search-result-op:before {
    content: 'op';
    width: 40px;
    display: inline-block;
    text-align: right;
    padding-right: 1ex;
    color: #666;
    font-size: 75%;
}

li.menu-search-result-prod:before {
    content: 'prod';
    width: 40px;
    display: inline-block;
    text-align: right;
    padding-right: 1ex;
    color: #666;
    font-size: 75%
}


li.menu-search-result-term:before {
    content: 'term';
    width: 40px;
    display: inline-block;
    text-align: right;
    padding-right: 1ex;
    color: #666;
    font-size: 75%
}

#menu-search-results ul {
  padding: 0 5px;
  margin: 0;
}

#menu-search-results li {
  white-space: nowrap;
  text-overflow: ellipsis;
}


#menu-trace-list {
  counter-reset: item;
  margin: 0 0 0 20px;
  padding: 0;
}
#menu-trace-list li {
  display: block;
  white-space: nowrap;
}

#menu-trace-list li .secnum:after {
  content: " ";
}
#menu-trace-list li:before {
    content: counter(item) " ";
    background-color: #222;
    counter-increment: item;
    color: #999;
    width: 20px;
    height: 20px;
    line-height: 20px;
    display: inline-block;
    text-align: center;
    margin: 2px 4px 2px 0;
}

@media (max-width: 1000px) {
  body {
    margin: 0;
    display: block;
  }

  #menu {
    display: none;
    padding-top: 3em;
    width: 450px;
  }

  #menu.active {
    position: fixed;
    height: 100%;
    left: 0;
    top: 0;
    right: 300px;
  }

  #menu-toggle {
    visibility: visible;
  }

  #spec-container {
    padding: 0 5px;
  }

  #references-pane-spacer {
    display: none;
  }
}

@media only screen and (max-width: 800px) {
  #menu {
    width: 100%;
  }

  h1 .secnum:empty {
    margin: 0; padding: 0;
  }
}


/* Toolbox */
.toolbox {
	position: absolute;
	background: #ddd;
	border: 1px solid #aaa;
  display: none;
  color: #eee;
  padding: 5px;
  border-radius: 3px;
}

.toolbox.active {
  display: inline-block;
}

.toolbox a {
  text-decoration: none;
  padding: 0 5px;
}

.toolbox a:hover {
  text-decoration: underline;
}

.toolbox:after, .toolbox:before {
	top: 100%;
	left: 15px;
	border: solid transparent;
	content: " ";
	height: 0;
	width: 0;
	position: absolute;
	pointer-events: none;
}

.toolbox:after {
	border-color: rgba(0, 0, 0, 0);
	border-top-color: #ddd;
	border-width: 10px;
	margin-left: -10px;
}
.toolbox:before {
	border-color: rgba(204, 204, 204, 0);
	border-top-color: #aaa;
	border-width: 12px;
	margin-left: -12px;
}

#references-pane-container {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 250px;
  display: none;
  background-color: #ddd;
  z-index: 1;
}

#references-pane-table-container {
  overflow-x: hidden;
  overflow-y: auto;
}

#references-pane-spacer {
  flex-basis: 33%;
  max-width: 500px;
}

#references-pane {
  flex-grow: 1;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

#references-pane-container.active {
  display: flex;
}

#references-pane-close:after {
  content: '✖';
  float: right;
  cursor: pointer;
}

#references-pane table tr td:first-child {
  text-align: right;
  padding-right: 5px;
}

@media print {
  #menu-toggle {
    display: none; 
  }
}
</style></head><body><div id="menu-toggle">☰</div><div id="menu-spacer"></div><div id="menu"><div id="menu-search"><input type="text" id="menu-search-box" placeholder="Search..."><div id="menu-search-results" class="inactive"></div></div><div id="menu-pins"><div class="menu-pane-header">Pins</div><ul id="menu-pins-list"></ul></div><div class="menu-pane-header">Table of Contents</div><div id="menu-toc"><ol class="toc"><li><span class="item-toggle-none"></span><a href="#introduction" title="Introduction">Introduction</a></li><li><span class="item-toggle-none"></span><a href="#sec-directive-prologues-and-the-use-strict-directive" title="Directive Prologues and the Use Strict Directive"><span class="secnum">1</span> Directive Prologues<del> and the Use Strict Directive</del></a></li><li><span class="item-toggle-none"></span><a href="#sec-function-implementation-hidden-code" title="Function Implementation Hidden Code"><span class="secnum">2</span> <ins>Function Implementation Hidden Code</ins></a></li><li><span class="item-toggle-none"></span><a href="#proposal-sec-function-definitions-runtime-semantics-instantiatefunctionobject" title="Runtime Semantics: InstantiateFunctionObject"><span class="secnum">3</span> RS: InstantiateFunctionObject</a></li><li><span class="item-toggle-none"></span><a href="#proposal-sec-function-definitions-runtime-semantics-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">4</span> RS: Evaluation</a></li><li><span class="item-toggle-none"></span><a href="#proposal-sec-arrow-function-definitions-runtime-semantics-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">5</span> RS: Evaluation</a></li><li><span class="item-toggle-none"></span><a href="#proposal-sec-runtime-semantics-definemethod" title="Runtime Semantics: DefineMethod"><span class="secnum">6</span> RS: DefineMethod</a></li><li><span class="item-toggle-none"></span><a href="#proposal-sec-method-definitions-runtime-semantics-propertydefinitionevaluation" title="Runtime Semantics: PropertyDefinitionEvaluation"><span class="secnum">7</span> RS: PropertyDefinitionEvaluation</a></li><li><span class="item-toggle-none"></span><a href="#proposal-sec-generator-function-definitions-runtime-semantics-instantiatefunctionobject" title="Runtime Semantics: InstantiateFunctionObject"><span class="secnum">8</span> RS: InstantiateFunctionObject</a></li><li><span class="item-toggle-none"></span><a href="#proposal-sec-generator-function-definitions-runtime-semantics-propertydefinitionevaluation" title="Runtime Semantics: PropertyDefinitionEvaluation"><span class="secnum">9</span> RS: PropertyDefinitionEvaluation</a></li><li><span class="item-toggle-none"></span><a href="#proposal-sec-generator-function-definitions-runtime-semantics-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">10</span> RS: Evaluation</a></li><li><span class="item-toggle-none"></span><a href="#proposal-sec-asyncgenerator-definitions-instantiatefunctionobject" title="Runtime Semantics: InstantiateFunctionObject"><span class="secnum">11</span> RS: InstantiateFunctionObject</a></li><li><span class="item-toggle-none"></span><a href="#proposal-sec-asyncgenerator-definitions-propertydefinitionevaluation" title="Runtime Semantics: PropertyDefinitionEvaluation"><span class="secnum">12</span> RS: PropertyDefinitionEvaluation</a></li><li><span class="item-toggle-none"></span><a href="#proposal-sec-asyncgenerator-definitions-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">13</span> RS: Evaluation</a></li><li><span class="item-toggle-none"></span><a href="#proposal-sec-runtime-semantics-bindingclassdeclarationevaluation" title="Runtime Semantics: BindingClassDeclarationEvaluation"><span class="secnum">14</span> RS: BindingClassDeclarationEvaluation</a></li><li><span class="item-toggle-none"></span><a href="#proposal-sec-class-definitions-runtime-semantics-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">15</span> RS: Evaluation</a></li><li><span class="item-toggle-none"></span><a href="#proposal-sec-async-function-definitions-InstantiateFunctionObject" title="Runtime Semantics: InstantiateFunctionObject"><span class="secnum">16</span> RS: InstantiateFunctionObject</a></li><li><span class="item-toggle-none"></span><a href="#proposal-sec-async-function-definitions-PropertyDefinitionEvaluation" title="Runtime Semantics: PropertyDefinitionEvaluation"><span class="secnum">17</span> RS: PropertyDefinitionEvaluation</a></li><li><span class="item-toggle-none"></span><a href="#proposal-sec-async-function-definitions-runtime-semantics-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">18</span> RS: Evaluation</a></li><li><span class="item-toggle-none"></span><a href="#proposal-sec-createdynamicfunction" title="Runtime Semantics: CreateDynamicFunction( constructor, newTarget, kind, args )"><span class="secnum">19</span> RS: CreateDynamicFunction( <var>constructor</var>, <var>newTarget</var>, <var>kind</var>, <var>args</var> )</a></li><li><span class="item-toggle-none"></span><a href="#proposal-sec-forbidden-extensions" title="Forbidden Extensions"><span class="secnum">20</span> Forbidden Extensions</a></li></ol></div></div><div id="spec-container"><h1 class="version first">Stage 1 Draft / March 15, 2019</h1><h1 class="title">Function implementation hiding</h1>

<emu-intro id="introduction">
  <h1>Introduction</h1>

  <p>Background explanatory material for this specification can be found in the  <a href="https://github.com/domenic/proposal-function-implementation-hiding">domenic/proposal-function-implementation-hiding</a> repository. See also the  <a href="https://github.com/domenic/proposal-function-implementation-hiding/issues">open issues</a>.</p>
</emu-intro>


<emu-clause id="sec-directive-prologues-and-the-use-strict-directive">
  <h1><span class="secnum">1</span>Directive Prologues<del> and the Use Strict Directive</del></h1>

  <p>A  <dfn id="directive-prologue">Directive Prologue</dfn> is the longest sequence of <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ExpressionStatement">ExpressionStatement</a></emu-nt>s occurring as the initial <emu-nt><a href="https://tc39.github.io/ecma262/#prod-StatementListItem">StatementListItem</a></emu-nt>s or <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ModuleItem">ModuleItem</a></emu-nt>s of a <emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt>, a <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ScriptBody">ScriptBody</a></emu-nt>,  <ins>a <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ClassBody">ClassBody</a></emu-nt>,  </ins>or a <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ModuleBody">ModuleBody</a></emu-nt> and where each <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ExpressionStatement">ExpressionStatement</a></emu-nt> in the sequence consists entirely of a <emu-nt><a href="https://tc39.github.io/ecma262/#prod-StringLiteral">StringLiteral</a></emu-nt> token followed by a semicolon. The semicolon may appear explicitly or may be inserted by automatic semicolon insertion. A <emu-xref href="#directive-prologue" id="_ref_1"><a href="#directive-prologue">Directive Prologue</a></emu-xref> may be an empty sequence.</p>

  <p>A  <dfn id="use-strict-directive">Use Strict Directive</dfn> is an <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ExpressionStatement">ExpressionStatement</a></emu-nt> in a <emu-xref href="#directive-prologue" id="_ref_2"><a href="#directive-prologue">Directive Prologue</a></emu-xref> whose <emu-nt><a href="https://tc39.github.io/ecma262/#prod-StringLiteral">StringLiteral</a></emu-nt> is either the exact code unit sequences <code>"use strict"</code> or <code>'use strict'</code>. A <emu-xref href="#use-strict-directive" id="_ref_3"><a href="#use-strict-directive">Use Strict Directive</a></emu-xref> may not contain an <emu-nt><a href="https://tc39.github.io/ecma262/#prod-EscapeSequence">EscapeSequence</a></emu-nt> or <emu-nt><a href="https://tc39.github.io/ecma262/#prod-LineContinuation">LineContinuation</a></emu-nt>.</p>

  <p><ins>A  <dfn id="hide-implementation-directive">Hide Implementation Directive</dfn> is an <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ExpressionStatement">ExpressionStatement</a></emu-nt> in a <emu-xref href="#directive-prologue" id="_ref_4"><a href="#directive-prologue">Directive Prologue</a></emu-xref> whose <emu-nt><a href="https://tc39.github.io/ecma262/#prod-StringLiteral">StringLiteral</a></emu-nt> is either the exact code unit sequences <code>"hide implementation"</code> or <code>'hide implementation'</code>. A <emu-xref href="#hide-implementation-directive" id="_ref_5"><a href="#hide-implementation-directive">Hide Implementation Directive</a></emu-xref> may not contain an <emu-nt><a href="https://tc39.github.io/ecma262/#prod-EscapeSequence">EscapeSequence</a></emu-nt> or <emu-nt><a href="https://tc39.github.io/ecma262/#prod-LineContinuation">LineContinuation</a></emu-nt>.</ins></p>

  <p>A <emu-xref href="#directive-prologue" id="_ref_6"><a href="#directive-prologue">Directive Prologue</a></emu-xref> may contain more than one  <del><emu-xref href="#use-strict-directive" id="_ref_7"><a href="#use-strict-directive">Use Strict Directive</a></emu-xref></del><ins>of a given type of directive</ins>. However, an implementation may issue a warning if this occurs.</p>

  <emu-note><span class="note">Note</span><div class="note-contents">
    <p>The <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ExpressionStatement">ExpressionStatement</a></emu-nt>s of a <emu-xref href="#directive-prologue" id="_ref_8"><a href="#directive-prologue">Directive Prologue</a></emu-xref> are evaluated normally during evaluation of the containing production. Implementations may define implementation specific meanings for <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ExpressionStatement">ExpressionStatement</a></emu-nt>s which are not  <del>a <emu-xref href="#use-strict-directive" id="_ref_9"><a href="#use-strict-directive">Use Strict Directive</a></emu-xref></del><ins>one of the above-defined directives</ins> and which occur in a <emu-xref href="#directive-prologue" id="_ref_10"><a href="#directive-prologue">Directive Prologue</a></emu-xref>. If an appropriate notification mechanism exists, an implementation should issue a warning if it encounters in a <emu-xref href="#directive-prologue" id="_ref_11"><a href="#directive-prologue">Directive Prologue</a></emu-xref> an <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ExpressionStatement">ExpressionStatement</a></emu-nt> that is not  <del>a <emu-xref href="#use-strict-directive" id="_ref_12"><a href="#use-strict-directive">Use Strict Directive</a></emu-xref></del><ins>one of the above-defined directives</ins> and which does not have a meaning defined by the implementation.</p>
  </div></emu-note>
</emu-clause>


<emu-clause id="sec-function-implementation-hidden-code">
  <h1><span class="secnum">2</span><ins>Function Implementation Hidden Code</ins></h1>
  <p>The output of  <emu-xref href="#sec-function.prototype.tostring" title=""><a href="https://tc39.github.io/ecma262/#sec-function.prototype.tostring">Function.prototype.toString ( )</a></emu-xref> and of any runtime mechanisms for inspecting an  <emu-xref href="#sec-error-objects"><a href="https://tc39.github.io/ecma262/#sec-error-objects">Error object</a></emu-xref>'s stack trace omits information about the function's implementation when the function was created inside function implementation hidden code. Code is interpreted as  <dfn>function implementation hidden code</dfn> in the following situations:</p>
  <ul>
    <li>
      Global code is function implementation hidden code if it begins with a <emu-xref href="#directive-prologue" id="_ref_13"><a href="#directive-prologue">Directive Prologue</a></emu-xref> that contains a <emu-xref href="#hide-implementation-directive" id="_ref_14"><a href="#hide-implementation-directive">Hide Implementation Directive</a></emu-xref>.
    
    </li>
    <li>
      Eval code is function implementation hidden code if it begins with a <emu-xref href="#directive-prologue" id="_ref_15"><a href="#directive-prologue">Directive Prologue</a></emu-xref> that contains a <emu-xref href="#hide-implementation-directive" id="_ref_16"><a href="#hide-implementation-directive">Hide Implementation Directive</a></emu-xref> or if the call to <code>eval</code> is a <emu-xref href="#sec-function-calls-runtime-semantics-evaluation"><a href="https://tc39.github.io/ecma262/#sec-function-calls-runtime-semantics-evaluation">direct eval</a></emu-xref> that is contained in function implementation hidden code.
    
    </li>
    <li>
      Function code is function implementation hidden code if the associated <emu-nt id="_ref_163"><a href="#prod-FunctionDeclaration">FunctionDeclaration</a></emu-nt>, <emu-nt id="_ref_164"><a href="#prod-FunctionExpression">FunctionExpression</a></emu-nt>, <emu-nt id="_ref_165"><a href="#prod-GeneratorDeclaration">GeneratorDeclaration</a></emu-nt>, <emu-nt id="_ref_166"><a href="#prod-GeneratorExpression">GeneratorExpression</a></emu-nt>, <emu-nt id="_ref_167"><a href="#prod-AsyncFunctionDeclaration">AsyncFunctionDeclaration</a></emu-nt>, <emu-nt id="_ref_168"><a href="#prod-AsyncFunctionExpression">AsyncFunctionExpression</a></emu-nt>, <emu-nt id="_ref_169"><a href="#prod-AsyncGeneratorDeclaration">AsyncGeneratorDeclaration</a></emu-nt>, <emu-nt id="_ref_170"><a href="#prod-AsyncGeneratorExpression">AsyncGeneratorExpression</a></emu-nt>, <emu-nt id="_ref_171"><a href="#prod-MethodDefinition">MethodDefinition</a></emu-nt>, <emu-nt id="_ref_172"><a href="#prod-ArrowFunction">ArrowFunction</a></emu-nt>, or <emu-nt><a href="https://tc39.github.io/ecma262/#prod-AsyncArrowFunction">AsyncArrowFunction</a></emu-nt> is contained in function implementation hidden code or if the code that produces the value of the function's [[ECMAScriptCode]] internal slot begins with a <emu-xref href="#directive-prologue" id="_ref_17"><a href="#directive-prologue">Directive Prologue</a></emu-xref> that contains a <emu-xref href="#hide-implementation-directive" id="_ref_18"><a href="#hide-implementation-directive">Hide Implementation Directive</a></emu-xref>.
    
    </li>
    <li>
      Class code is function implementation hidden code if the associated <emu-nt id="_ref_173"><a href="#prod-ClassDeclaration">ClassDeclaration</a></emu-nt> or <emu-nt id="_ref_174"><a href="#prod-ClassExpression">ClassExpression</a></emu-nt> is contained in function implementation hidden code or if the code that produces the value of the class constructor's [[ECMAScriptCode]] internal slot begins with a <emu-xref href="#directive-prologue" id="_ref_19"><a href="#directive-prologue">Directive Prologue</a></emu-xref> that contains a <emu-xref href="#hide-implementation-directive" id="_ref_20"><a href="#hide-implementation-directive">Hide Implementation Directive</a></emu-xref>.
    
    </li>
    <li>
      Function code that is supplied as the arguments to the built-in <code>Function</code>, <code>Generator</code>, <code>AsyncFunction</code>, and <code>AsyncGenerator</code> constructors is function implementation hidden code if the last argument is a String that when processed is a <emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt> that begins with a <emu-xref href="#directive-prologue" id="_ref_21"><a href="#directive-prologue">Directive Prologue</a></emu-xref> that contains a <emu-xref href="#hide-implementation-directive" id="_ref_22"><a href="#hide-implementation-directive">Hide Implementation Directive</a></emu-xref>.
    
    </li>
  </ul>
</emu-clause>


<emu-clause id="proposal-sec-function-definitions-runtime-semantics-instantiatefunctionobject">
  <h1><span class="secnum">3</span>Runtime Semantics: InstantiateFunctionObject</h1>
  <p>With parameter <var>scope</var>.</p>
  <emu-see-also-para op="InstantiateFunctionObject"></emu-see-also-para>
  <emu-grammar><emu-production name="FunctionDeclaration" collapsed="" id="prod-FunctionDeclaration">
    <emu-nt><a href="#prod-FunctionDeclaration">FunctionDeclaration</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="81739a57"><emu-t>function</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt><emu-t>(</emu-t><emu-nt id="_ref_175"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>If the function code for <emu-nt id="_ref_176"><a href="#prod-FunctionDeclaration">FunctionDeclaration</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>name</var> be StringValue of <emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>.</li><li>Let <var>F</var> be <emu-xref aoid="FunctionCreate" id="_ref_23"><a href="https://tc39.github.io/ecma262/#sec-functioncreate">FunctionCreate</a></emu-xref>(<emu-const>Normal</emu-const>, <emu-nt id="_ref_177"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt>, <emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt>, <var>scope</var>, <var>strict</var>).</li><li>Perform <emu-xref aoid="MakeConstructor" id="_ref_24"><a href="https://tc39.github.io/ecma262/#sec-makeconstructor">MakeConstructor</a></emu-xref>(<var>F</var>).</li><li>Perform <emu-xref aoid="SetFunctionName" id="_ref_25"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>F</var>, <var>name</var>).</li><li><ins>If the code matched by this <emu-nt id="_ref_178"><a href="#prod-FunctionDeclaration">FunctionDeclaration</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_26"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>F</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_179"><a href="#prod-FunctionDeclaration">FunctionDeclaration</a></emu-nt>.</li><li>Return <var>F</var>.
  </li></ol></emu-alg>
  <emu-grammar><emu-production name="FunctionDeclaration" collapsed="">
    <emu-nt><a href="#prod-FunctionDeclaration">FunctionDeclaration</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="b26bacea"><emu-t>function</emu-t><emu-t>(</emu-t><emu-nt id="_ref_180"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>If the function code for <emu-nt id="_ref_181"><a href="#prod-FunctionDeclaration">FunctionDeclaration</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>F</var> be <emu-xref aoid="FunctionCreate" id="_ref_27"><a href="https://tc39.github.io/ecma262/#sec-functioncreate">FunctionCreate</a></emu-xref>(<emu-const>Normal</emu-const>, <emu-nt id="_ref_182"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt>, <emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt>, <var>scope</var>, <var>strict</var>).</li><li>Perform <emu-xref aoid="MakeConstructor" id="_ref_28"><a href="https://tc39.github.io/ecma262/#sec-makeconstructor">MakeConstructor</a></emu-xref>(<var>F</var>).</li><li>Perform <emu-xref aoid="SetFunctionName" id="_ref_29"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>F</var>, <code>"default"</code>).</li><li><ins>If the code matched by this <emu-nt id="_ref_183"><a href="#prod-FunctionDeclaration">FunctionDeclaration</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_30"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>F</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_184"><a href="#prod-FunctionDeclaration">FunctionDeclaration</a></emu-nt>.</li><li>Return <var>F</var>.
  </li></ol></emu-alg>
  <emu-note><span class="note">Note</span><div class="note-contents">
    <p>An anonymous <emu-nt id="_ref_185"><a href="#prod-FunctionDeclaration">FunctionDeclaration</a></emu-nt> can only occur as part of an <code>export default</code> declaration.</p>
  </div></emu-note>
</emu-clause>


<emu-clause id="proposal-sec-function-definitions-runtime-semantics-evaluation">
  <h1><span class="secnum">4</span>Runtime Semantics: Evaluation</h1>
  <emu-grammar><emu-production name="FunctionDeclaration" collapsed="">
    <emu-nt><a href="#prod-FunctionDeclaration">FunctionDeclaration</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="81739a57"><emu-t>function</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt><emu-t>(</emu-t><emu-nt id="_ref_186"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>Return <emu-xref aoid="NormalCompletion" id="_ref_31"><a href="https://tc39.github.io/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<emu-const>empty</emu-const>).
  </li></ol></emu-alg>
  <emu-note><span class="note">Note 1</span><div class="note-contents">
    <p>An alternative semantics is provided in  <emu-xref href="#sec-block-level-function-declarations-web-legacy-compatibility-semantics"><a href="https://tc39.github.io/ecma262/#sec-block-level-function-declarations-web-legacy-compatibility-semantics">B.3.3</a></emu-xref>.</p>
  </div></emu-note>
  <emu-grammar><emu-production name="FunctionDeclaration" collapsed="">
    <emu-nt><a href="#prod-FunctionDeclaration">FunctionDeclaration</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="b26bacea"><emu-t>function</emu-t><emu-t>(</emu-t><emu-nt id="_ref_187"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>Return <emu-xref aoid="NormalCompletion" id="_ref_32"><a href="https://tc39.github.io/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<emu-const>empty</emu-const>).
  </li></ol></emu-alg>
  <emu-grammar><emu-production name="FunctionExpression" collapsed="" id="prod-FunctionExpression">
    <emu-nt><a href="#prod-FunctionExpression">FunctionExpression</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="b26bacea"><emu-t>function</emu-t><emu-t>(</emu-t><emu-nt id="_ref_188"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>If the function code for <emu-nt id="_ref_189"><a href="#prod-FunctionExpression">FunctionExpression</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>scope</var> be the LexicalEnvironment of the <emu-xref href="#running-execution-context"><a href="https://tc39.github.io/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Let <var>closure</var> be <emu-xref aoid="FunctionCreate" id="_ref_33"><a href="https://tc39.github.io/ecma262/#sec-functioncreate">FunctionCreate</a></emu-xref>(<emu-const>Normal</emu-const>, <emu-nt id="_ref_190"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt>, <emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt>, <var>scope</var>, <var>strict</var>).</li><li>Perform <emu-xref aoid="MakeConstructor" id="_ref_34"><a href="https://tc39.github.io/ecma262/#sec-makeconstructor">MakeConstructor</a></emu-xref>(<var>closure</var>).</li><li><ins>If the code matched by this <emu-nt id="_ref_191"><a href="#prod-FunctionExpression">FunctionExpression</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_35"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>closure</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_192"><a href="#prod-FunctionExpression">FunctionExpression</a></emu-nt>.</li><li>Return <var>closure</var>.
  </li></ol></emu-alg>
  <emu-grammar><emu-production name="FunctionExpression" collapsed="">
    <emu-nt><a href="#prod-FunctionExpression">FunctionExpression</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="81739a57"><emu-t>function</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt><emu-t>(</emu-t><emu-nt id="_ref_193"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>If the function code for <emu-nt id="_ref_194"><a href="#prod-FunctionExpression">FunctionExpression</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>scope</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.github.io/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment.</li><li>Let <var>funcEnv</var> be <emu-xref aoid="NewDeclarativeEnvironment" id="_ref_36"><a href="https://tc39.github.io/ecma262/#sec-newdeclarativeenvironment">NewDeclarativeEnvironment</a></emu-xref>(<var>scope</var>).</li><li>Let <var>envRec</var> be <var>funcEnv</var>'s <emu-xref href="#sec-lexical-environments"><a href="https://tc39.github.io/ecma262/#sec-lexical-environments">EnvironmentRecord</a></emu-xref>.</li><li>Let <var>name</var> be StringValue of <emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>.</li><li>Perform <var>envRec</var>.CreateImmutableBinding(<var>name</var>, <emu-val>false</emu-val>).</li><li>Let <var>closure</var> be <emu-xref aoid="FunctionCreate" id="_ref_37"><a href="https://tc39.github.io/ecma262/#sec-functioncreate">FunctionCreate</a></emu-xref>(<emu-const>Normal</emu-const>, <emu-nt id="_ref_195"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt>, <emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt>, <var>funcEnv</var>, <var>strict</var>).</li><li>Perform <emu-xref aoid="MakeConstructor" id="_ref_38"><a href="https://tc39.github.io/ecma262/#sec-makeconstructor">MakeConstructor</a></emu-xref>(<var>closure</var>).</li><li>Perform <emu-xref aoid="SetFunctionName" id="_ref_39"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>closure</var>, <var>name</var>).</li><li><ins>If the code matched by this <emu-nt id="_ref_196"><a href="#prod-FunctionExpression">FunctionExpression</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_40"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>closure</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_197"><a href="#prod-FunctionExpression">FunctionExpression</a></emu-nt>.</li><li>Perform <var>envRec</var>.InitializeBinding(<var>name</var>, <var>closure</var>).</li><li>Return <var>closure</var>.
  </li></ol></emu-alg>
  <emu-note><span class="note">Note 2</span><div class="note-contents">
    <p>The <emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt> in a <emu-nt id="_ref_198"><a href="#prod-FunctionExpression">FunctionExpression</a></emu-nt> can be referenced from inside the <emu-nt id="_ref_199"><a href="#prod-FunctionExpression">FunctionExpression</a></emu-nt>'s <emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt> to allow the function to call itself recursively. However, unlike in a <emu-nt id="_ref_200"><a href="#prod-FunctionDeclaration">FunctionDeclaration</a></emu-nt>, the <emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt> in a <emu-nt id="_ref_201"><a href="#prod-FunctionExpression">FunctionExpression</a></emu-nt> cannot be referenced from and does not affect the scope enclosing the <emu-nt id="_ref_202"><a href="#prod-FunctionExpression">FunctionExpression</a></emu-nt>.</p>
  </div></emu-note>
  <emu-note><span class="note">Note 3</span><div class="note-contents">
    <p>A <code>prototype</code> property is automatically created for every function defined using a <emu-nt id="_ref_203"><a href="#prod-FunctionDeclaration">FunctionDeclaration</a></emu-nt> or <emu-nt id="_ref_204"><a href="#prod-FunctionExpression">FunctionExpression</a></emu-nt>, to allow for the possibility that the function will be used as a constructor.</p>
  </div></emu-note>
  <emu-grammar><emu-production name="FunctionStatementList" collapsed="" id="prod-FunctionStatementList">
    <emu-nt><a href="#prod-FunctionStatementList">FunctionStatementList</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="37b9c04c"><emu-gann>[empty]</emu-gann></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>Return <emu-xref aoid="NormalCompletion" id="_ref_41"><a href="https://tc39.github.io/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<emu-val>undefined</emu-val>).
  </li></ol></emu-alg>
</emu-clause>


<emu-clause id="proposal-sec-arrow-function-definitions-runtime-semantics-evaluation">
  <h1><span class="secnum">5</span>Runtime Semantics: Evaluation</h1>
  <emu-grammar><emu-production name="ArrowFunction" collapsed="" id="prod-ArrowFunction">
    <emu-nt><a href="#prod-ArrowFunction">ArrowFunction</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="2a7a3456"><emu-nt><a href="https://tc39.github.io/ecma262/#prod-ArrowParameters">ArrowParameters</a></emu-nt><emu-t>=&gt;</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-ConciseBody">ConciseBody</a></emu-nt></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>If the function code for this <emu-nt id="_ref_205"><a href="#prod-ArrowFunction">ArrowFunction</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>scope</var> be the LexicalEnvironment of the <emu-xref href="#running-execution-context"><a href="https://tc39.github.io/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Let <var>parameters</var> be CoveredFormalsList of <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ArrowParameters">ArrowParameters</a></emu-nt>.</li><li>Let <var>closure</var> be <emu-xref aoid="FunctionCreate" id="_ref_42"><a href="https://tc39.github.io/ecma262/#sec-functioncreate">FunctionCreate</a></emu-xref>(<emu-const>Arrow</emu-const>, <var>parameters</var>, <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ConciseBody">ConciseBody</a></emu-nt>, <var>scope</var>, <var>strict</var>).</li><li><ins>If the code matched by this <emu-nt id="_ref_206"><a href="#prod-ArrowFunction">ArrowFunction</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_43"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>closure</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_207"><a href="#prod-ArrowFunction">ArrowFunction</a></emu-nt>.</li><li>Return <var>closure</var>.
  </li></ol></emu-alg>
  <emu-note><span class="note">Note</span><div class="note-contents">
    <p>An <emu-nt id="_ref_208"><a href="#prod-ArrowFunction">ArrowFunction</a></emu-nt> does not define local bindings for <code>arguments</code>, <code>super</code>, <code>this</code>, or <code>new.target</code>. Any reference to <code>arguments</code>, <code>super</code>, <code>this</code>, or <code>new.target</code> within an <emu-nt id="_ref_209"><a href="#prod-ArrowFunction">ArrowFunction</a></emu-nt> must resolve to a binding in a lexically enclosing environment. Typically this will be the Function Environment of an immediately enclosing function. Even though an <emu-nt id="_ref_210"><a href="#prod-ArrowFunction">ArrowFunction</a></emu-nt> may contain references to <code>super</code>, the function object created in step 4 is not made into a method by performing <emu-xref aoid="MakeMethod" id="_ref_44"><a href="https://tc39.github.io/ecma262/#sec-makemethod">MakeMethod</a></emu-xref>. An <emu-nt id="_ref_211"><a href="#prod-ArrowFunction">ArrowFunction</a></emu-nt> that references <code>super</code> is always contained within a non-<emu-nt id="_ref_212"><a href="#prod-ArrowFunction">ArrowFunction</a></emu-nt> and the necessary state to implement <code>super</code> is accessible via the <var>scope</var> that is captured by the function object of the <emu-nt id="_ref_213"><a href="#prod-ArrowFunction">ArrowFunction</a></emu-nt>.</p>
  </div></emu-note>
</emu-clause>


<emu-clause id="proposal-sec-runtime-semantics-definemethod">
  <h1><span class="secnum">6</span>Runtime Semantics: DefineMethod</h1>
  <p>With parameters <var>object</var> and optional parameter <var>functionPrototype</var>.</p>
  <emu-grammar><emu-production name="MethodDefinition" collapsed="" id="prod-MethodDefinition">
    <emu-nt><a href="#prod-MethodDefinition">MethodDefinition</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="127f1e91"><emu-nt><a href="https://tc39.github.io/ecma262/#prod-PropertyName">PropertyName</a></emu-nt><emu-t>(</emu-t><emu-nt>StrictFormalParameters</emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>Let <var>propKey</var> be the result of evaluating <emu-nt><a href="https://tc39.github.io/ecma262/#prod-PropertyName">PropertyName</a></emu-nt>.</li><li><emu-xref aoid="ReturnIfAbrupt" id="_ref_45"><a href="https://tc39.github.io/ecma262/#sec-returnifabrupt">ReturnIfAbrupt</a></emu-xref>(<var>propKey</var>).</li><li>If the function code for this <emu-nt id="_ref_214"><a href="#prod-MethodDefinition">MethodDefinition</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>scope</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.github.io/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment.</li><li>If <var>functionPrototype</var> was passed as a parameter, let <var>kind</var> be <emu-const>Normal</emu-const>; otherwise let <var>kind</var> be <emu-const>Method</emu-const>.</li><li>Let <var>closure</var> be <emu-xref aoid="FunctionCreate" id="_ref_46"><a href="https://tc39.github.io/ecma262/#sec-functioncreate">FunctionCreate</a></emu-xref>(<var>kind</var>, <emu-nt>StrictFormalParameters</emu-nt>, <emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt>, <var>scope</var>, <var>strict</var>). If <var>functionPrototype</var> was passed as a parameter, then pass its value as the <var>prototype</var> optional argument of <emu-xref aoid="FunctionCreate" id="_ref_47"><a href="https://tc39.github.io/ecma262/#sec-functioncreate">FunctionCreate</a></emu-xref>.</li><li>Perform <emu-xref aoid="MakeMethod" id="_ref_48"><a href="https://tc39.github.io/ecma262/#sec-makemethod">MakeMethod</a></emu-xref>(<var>closure</var>, <var>object</var>).</li><li><ins>If the code matched by this <emu-nt id="_ref_215"><a href="#prod-MethodDefinition">MethodDefinition</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_49"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>closure</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_216"><a href="#prod-MethodDefinition">MethodDefinition</a></emu-nt>.</li><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.github.io/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref>{[[Key]]: <var>propKey</var>, [[Closure]]: <var>closure</var>}.
  </li></ol></emu-alg>
</emu-clause>


<emu-clause id="proposal-sec-method-definitions-runtime-semantics-propertydefinitionevaluation">
  <h1><span class="secnum">7</span>Runtime Semantics: PropertyDefinitionEvaluation</h1>
  <p>With parameters <var>object</var> and <var>enumerable</var>.</p>
  <emu-see-also-para op="PropertyDefinitionEvaluation"></emu-see-also-para>
  <emu-grammar><emu-production name="MethodDefinition" collapsed="">
    <emu-nt><a href="#prod-MethodDefinition">MethodDefinition</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="127f1e91"><emu-nt><a href="https://tc39.github.io/ecma262/#prod-PropertyName">PropertyName</a></emu-nt><emu-t>(</emu-t><emu-nt>StrictFormalParameters</emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>Let <var>methodDef</var> be DefineMethod of <emu-nt id="_ref_217"><a href="#prod-MethodDefinition">MethodDefinition</a></emu-nt> with argument <var>object</var>.</li><li><emu-xref aoid="ReturnIfAbrupt" id="_ref_50"><a href="https://tc39.github.io/ecma262/#sec-returnifabrupt">ReturnIfAbrupt</a></emu-xref>(<var>methodDef</var>).</li><li>Perform <emu-xref aoid="SetFunctionName" id="_ref_51"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>methodDef</var>.[[Closure]], <var>methodDef</var>.[[Key]]).</li><li>Let <var>desc</var> be the PropertyDescriptor{[[Value]]: <var>methodDef</var>.[[Closure]], [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <var>enumerable</var>, [[Configurable]]: <emu-val>true</emu-val>}.</li><li>Return ?&nbsp;<emu-xref aoid="DefinePropertyOrThrow" id="_ref_52"><a href="https://tc39.github.io/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>object</var>, <var>methodDef</var>.[[Key]], <var>desc</var>).
  </li></ol></emu-alg>
  <emu-grammar><emu-production name="MethodDefinition" collapsed="">
    <emu-nt><a href="#prod-MethodDefinition">MethodDefinition</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="52fe7349"><emu-nt id="_ref_218"><a href="#prod-GeneratorMethod">GeneratorMethod</a></emu-nt></emu-rhs>
</emu-production></emu-grammar>
  <p>See  <emu-xref href="#sec-generator-function-definitions"><a href="https://tc39.github.io/ecma262/#sec-generator-function-definitions">14.4</a></emu-xref>.</p>
  <emu-grammar><emu-production name="MethodDefinition" collapsed="">
    <emu-nt><a href="#prod-MethodDefinition">MethodDefinition</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="f1487956"><emu-t>get</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-PropertyName">PropertyName</a></emu-nt><emu-t>(</emu-t><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>Let <var>propKey</var> be the result of evaluating <emu-nt><a href="https://tc39.github.io/ecma262/#prod-PropertyName">PropertyName</a></emu-nt>.</li><li><emu-xref aoid="ReturnIfAbrupt" id="_ref_53"><a href="https://tc39.github.io/ecma262/#sec-returnifabrupt">ReturnIfAbrupt</a></emu-xref>(<var>propKey</var>).</li><li>If the function code for this <emu-nt id="_ref_219"><a href="#prod-MethodDefinition">MethodDefinition</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>scope</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.github.io/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment.</li><li>Let <var>formalParameterList</var> be the production <emu-grammar><emu-production name="FormalParameters" collapsed="" id="prod-FormalParameters" class=" inline">
    <emu-nt><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="37b9c04c"><emu-gann>[empty]</emu-gann></emu-rhs>
</emu-production></emu-grammar>.</li><li>Let <var>closure</var> be <emu-xref aoid="FunctionCreate" id="_ref_54"><a href="https://tc39.github.io/ecma262/#sec-functioncreate">FunctionCreate</a></emu-xref>(<emu-const>Method</emu-const>, <var>formalParameterList</var>, <emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt>, <var>scope</var>, <var>strict</var>).</li><li>Perform <emu-xref aoid="MakeMethod" id="_ref_55"><a href="https://tc39.github.io/ecma262/#sec-makemethod">MakeMethod</a></emu-xref>(<var>closure</var>, <var>object</var>).</li><li>Perform <emu-xref aoid="SetFunctionName" id="_ref_56"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>closure</var>, <var>propKey</var>, <code>"get"</code>).</li><li><ins>If the code matched by this <emu-nt id="_ref_220"><a href="#prod-MethodDefinition">MethodDefinition</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_57"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>closure</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_221"><a href="#prod-MethodDefinition">MethodDefinition</a></emu-nt>.</li><li>Let <var>desc</var> be the PropertyDescriptor{[[Get]]: <var>closure</var>, [[Enumerable]]: <var>enumerable</var>, [[Configurable]]: <emu-val>true</emu-val>}.</li><li>Return ?&nbsp;<emu-xref aoid="DefinePropertyOrThrow" id="_ref_58"><a href="https://tc39.github.io/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>object</var>, <var>propKey</var>, <var>desc</var>).
  </li></ol></emu-alg>
  <emu-grammar><emu-production name="MethodDefinition" collapsed="">
    <emu-nt><a href="#prod-MethodDefinition">MethodDefinition</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="4402354c"><emu-t>set</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-PropertyName">PropertyName</a></emu-nt><emu-t>(</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-PropertySetParameterList">PropertySetParameterList</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>Let <var>propKey</var> be the result of evaluating <emu-nt><a href="https://tc39.github.io/ecma262/#prod-PropertyName">PropertyName</a></emu-nt>.</li><li><emu-xref aoid="ReturnIfAbrupt" id="_ref_59"><a href="https://tc39.github.io/ecma262/#sec-returnifabrupt">ReturnIfAbrupt</a></emu-xref>(<var>propKey</var>).</li><li>If the function code for this <emu-nt id="_ref_222"><a href="#prod-MethodDefinition">MethodDefinition</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>scope</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.github.io/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment.</li><li>Let <var>closure</var> be <emu-xref aoid="FunctionCreate" id="_ref_60"><a href="https://tc39.github.io/ecma262/#sec-functioncreate">FunctionCreate</a></emu-xref>(<emu-const>Method</emu-const>, <emu-nt><a href="https://tc39.github.io/ecma262/#prod-PropertySetParameterList">PropertySetParameterList</a></emu-nt>, <emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt>, <var>scope</var>, <var>strict</var>).</li><li>Perform <emu-xref aoid="MakeMethod" id="_ref_61"><a href="https://tc39.github.io/ecma262/#sec-makemethod">MakeMethod</a></emu-xref>(<var>closure</var>, <var>object</var>).</li><li>Perform <emu-xref aoid="SetFunctionName" id="_ref_62"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>closure</var>, <var>propKey</var>, <code>"set"</code>).</li><li><ins>If the code matched by this <emu-nt id="_ref_223"><a href="#prod-MethodDefinition">MethodDefinition</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_63"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>closure</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_224"><a href="#prod-MethodDefinition">MethodDefinition</a></emu-nt>.</li><li>Let <var>desc</var> be the PropertyDescriptor{[[Set]]: <var>closure</var>, [[Enumerable]]: <var>enumerable</var>, [[Configurable]]: <emu-val>true</emu-val>}.</li><li>Return ?&nbsp;<emu-xref aoid="DefinePropertyOrThrow" id="_ref_64"><a href="https://tc39.github.io/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>object</var>, <var>propKey</var>, <var>desc</var>).
  </li></ol></emu-alg>
</emu-clause>


<emu-clause id="proposal-sec-generator-function-definitions-runtime-semantics-instantiatefunctionobject">
  <h1><span class="secnum">8</span>Runtime Semantics: InstantiateFunctionObject</h1>
  <p>With parameter <var>scope</var>.</p>
  <emu-see-also-para op="InstantiateFunctionObject"></emu-see-also-para>
  <emu-grammar><emu-production name="GeneratorDeclaration" collapsed="" id="prod-GeneratorDeclaration">
    <emu-nt><a href="#prod-GeneratorDeclaration">GeneratorDeclaration</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="7dbc99b6"><emu-t>function</emu-t><emu-t>*</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt><emu-t>(</emu-t><emu-nt id="_ref_225"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-GeneratorBody">GeneratorBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>If the function code for <emu-nt id="_ref_226"><a href="#prod-GeneratorDeclaration">GeneratorDeclaration</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>name</var> be StringValue of <emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>.</li><li>Let <var>F</var> be <emu-xref aoid="GeneratorFunctionCreate" id="_ref_65"><a href="https://tc39.github.io/ecma262/#sec-generatorfunctioncreate">GeneratorFunctionCreate</a></emu-xref>(<emu-const>Normal</emu-const>, <emu-nt id="_ref_227"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt>, <emu-nt><a href="https://tc39.github.io/ecma262/#prod-GeneratorBody">GeneratorBody</a></emu-nt>, <var>scope</var>, <var>strict</var>).</li><li>Let <var>prototype</var> be <emu-xref aoid="ObjectCreate" id="_ref_66"><a href="https://tc39.github.io/ecma262/#sec-objectcreate">ObjectCreate</a></emu-xref>(<emu-xref href="#sec-properties-of-generator-prototype"><a href="https://tc39.github.io/ecma262/#sec-properties-of-generator-prototype">%GeneratorPrototype%</a></emu-xref>).</li><li>Perform <emu-xref aoid="DefinePropertyOrThrow" id="_ref_67"><a href="https://tc39.github.io/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>F</var>, <code>"prototype"</code>, PropertyDescriptor{[[Value]]: <var>prototype</var>, [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>false</emu-val>}).</li><li>Perform <emu-xref aoid="SetFunctionName" id="_ref_68"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>F</var>, <var>name</var>).</li><li><ins>If the code matched by this <emu-nt id="_ref_228"><a href="#prod-GeneratorDeclaration">GeneratorDeclaration</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_69"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>F</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_229"><a href="#prod-GeneratorDeclaration">GeneratorDeclaration</a></emu-nt>.</li><li>Return <var>F</var>.
  </li></ol></emu-alg>
  <emu-grammar><emu-production name="GeneratorDeclaration" collapsed="">
    <emu-nt><a href="#prod-GeneratorDeclaration">GeneratorDeclaration</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="0d271960"><emu-t>function</emu-t><emu-t>*</emu-t><emu-t>(</emu-t><emu-nt id="_ref_230"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-GeneratorBody">GeneratorBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>If the function code for <emu-nt id="_ref_231"><a href="#prod-GeneratorDeclaration">GeneratorDeclaration</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>F</var> be <emu-xref aoid="GeneratorFunctionCreate" id="_ref_70"><a href="https://tc39.github.io/ecma262/#sec-generatorfunctioncreate">GeneratorFunctionCreate</a></emu-xref>(<emu-const>Normal</emu-const>, <emu-nt id="_ref_232"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt>, <emu-nt><a href="https://tc39.github.io/ecma262/#prod-GeneratorBody">GeneratorBody</a></emu-nt>, <var>scope</var>, <var>strict</var>).</li><li>Let <var>prototype</var> be <emu-xref aoid="ObjectCreate" id="_ref_71"><a href="https://tc39.github.io/ecma262/#sec-objectcreate">ObjectCreate</a></emu-xref>(<emu-xref href="#sec-properties-of-generator-prototype"><a href="https://tc39.github.io/ecma262/#sec-properties-of-generator-prototype">%GeneratorPrototype%</a></emu-xref>).</li><li>Perform <emu-xref aoid="DefinePropertyOrThrow" id="_ref_72"><a href="https://tc39.github.io/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>F</var>, <code>"prototype"</code>, PropertyDescriptor{[[Value]]: <var>prototype</var>, [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>false</emu-val>}).</li><li>Perform <emu-xref aoid="SetFunctionName" id="_ref_73"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>F</var>, <code>"default"</code>).</li><li><ins>If the code matched by this <emu-nt id="_ref_233"><a href="#prod-GeneratorDeclaration">GeneratorDeclaration</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_74"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>F</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_234"><a href="#prod-GeneratorDeclaration">GeneratorDeclaration</a></emu-nt>.</li><li>Return <var>F</var>.
  </li></ol></emu-alg>
  <emu-note><span class="note">Note</span><div class="note-contents">
    <p>An anonymous <emu-nt id="_ref_235"><a href="#prod-GeneratorDeclaration">GeneratorDeclaration</a></emu-nt> can only occur as part of an <code>export default</code> declaration.</p>
  </div></emu-note>
</emu-clause>


<emu-clause id="proposal-sec-generator-function-definitions-runtime-semantics-propertydefinitionevaluation">
  <h1><span class="secnum">9</span>Runtime Semantics: PropertyDefinitionEvaluation</h1>
  <p>With parameter <var>object</var> and <var>enumerable</var>.</p>
  <emu-see-also-para op="PropertyDefinitionEvaluation"></emu-see-also-para>
  <emu-grammar><emu-production name="GeneratorMethod" collapsed="" id="prod-GeneratorMethod">
    <emu-nt><a href="#prod-GeneratorMethod">GeneratorMethod</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="3977072d"><emu-t>*</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-PropertyName">PropertyName</a></emu-nt><emu-t>(</emu-t><emu-nt>StrictFormalParameters</emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-GeneratorBody">GeneratorBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>Let <var>propKey</var> be the result of evaluating <emu-nt><a href="https://tc39.github.io/ecma262/#prod-PropertyName">PropertyName</a></emu-nt>.</li><li><emu-xref aoid="ReturnIfAbrupt" id="_ref_75"><a href="https://tc39.github.io/ecma262/#sec-returnifabrupt">ReturnIfAbrupt</a></emu-xref>(<var>propKey</var>).</li><li>If the function code for this <emu-nt id="_ref_236"><a href="#prod-GeneratorMethod">GeneratorMethod</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>scope</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.github.io/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment.</li><li>Let <var>closure</var> be <emu-xref aoid="GeneratorFunctionCreate" id="_ref_76"><a href="https://tc39.github.io/ecma262/#sec-generatorfunctioncreate">GeneratorFunctionCreate</a></emu-xref>(<emu-const>Method</emu-const>, <emu-nt>StrictFormalParameters</emu-nt>, <emu-nt><a href="https://tc39.github.io/ecma262/#prod-GeneratorBody">GeneratorBody</a></emu-nt>, <var>scope</var>, <var>strict</var>).</li><li>Perform <emu-xref aoid="MakeMethod" id="_ref_77"><a href="https://tc39.github.io/ecma262/#sec-makemethod">MakeMethod</a></emu-xref>(<var>closure</var>, <var>object</var>).</li><li>Let <var>prototype</var> be <emu-xref aoid="ObjectCreate" id="_ref_78"><a href="https://tc39.github.io/ecma262/#sec-objectcreate">ObjectCreate</a></emu-xref>(<emu-xref href="#sec-properties-of-generator-prototype"><a href="https://tc39.github.io/ecma262/#sec-properties-of-generator-prototype">%GeneratorPrototype%</a></emu-xref>).</li><li>Perform <emu-xref aoid="DefinePropertyOrThrow" id="_ref_79"><a href="https://tc39.github.io/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>closure</var>, <code>"prototype"</code>, PropertyDescriptor{[[Value]]: <var>prototype</var>, [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>false</emu-val>}).</li><li>Perform <emu-xref aoid="SetFunctionName" id="_ref_80"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>closure</var>, <var>propKey</var>).</li><li><ins>If the code matched by this <emu-nt id="_ref_237"><a href="#prod-GeneratorMethod">GeneratorMethod</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_81"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>closure</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_238"><a href="#prod-GeneratorMethod">GeneratorMethod</a></emu-nt>.</li><li>Let <var>desc</var> be the PropertyDescriptor{[[Value]]: <var>closure</var>, [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <var>enumerable</var>, [[Configurable]]: <emu-val>true</emu-val>}.</li><li>Return ?&nbsp;<emu-xref aoid="DefinePropertyOrThrow" id="_ref_82"><a href="https://tc39.github.io/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>object</var>, <var>propKey</var>, <var>desc</var>).
  </li></ol></emu-alg>
</emu-clause>


<emu-clause id="proposal-sec-generator-function-definitions-runtime-semantics-evaluation">
  <h1><span class="secnum">10</span>Runtime Semantics: Evaluation</h1>
  <emu-grammar><emu-production name="GeneratorExpression" collapsed="" id="prod-GeneratorExpression">
    <emu-nt><a href="#prod-GeneratorExpression">GeneratorExpression</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="0d271960"><emu-t>function</emu-t><emu-t>*</emu-t><emu-t>(</emu-t><emu-nt id="_ref_239"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-GeneratorBody">GeneratorBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>If the function code for this <emu-nt id="_ref_240"><a href="#prod-GeneratorExpression">GeneratorExpression</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>scope</var> be the LexicalEnvironment of the <emu-xref href="#running-execution-context"><a href="https://tc39.github.io/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Let <var>closure</var> be <emu-xref aoid="GeneratorFunctionCreate" id="_ref_83"><a href="https://tc39.github.io/ecma262/#sec-generatorfunctioncreate">GeneratorFunctionCreate</a></emu-xref>(<emu-const>Normal</emu-const>, <emu-nt id="_ref_241"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt>, <emu-nt><a href="https://tc39.github.io/ecma262/#prod-GeneratorBody">GeneratorBody</a></emu-nt>, <var>scope</var>, <var>strict</var>).</li><li>Let <var>prototype</var> be <emu-xref aoid="ObjectCreate" id="_ref_84"><a href="https://tc39.github.io/ecma262/#sec-objectcreate">ObjectCreate</a></emu-xref>(<emu-xref href="#sec-properties-of-generator-prototype"><a href="https://tc39.github.io/ecma262/#sec-properties-of-generator-prototype">%GeneratorPrototype%</a></emu-xref>).</li><li>Perform <emu-xref aoid="DefinePropertyOrThrow" id="_ref_85"><a href="https://tc39.github.io/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>closure</var>, <code>"prototype"</code>, PropertyDescriptor{[[Value]]: <var>prototype</var>, [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>false</emu-val>}).</li><li><ins>If the code matched by this <emu-nt id="_ref_242"><a href="#prod-GeneratorExpression">GeneratorExpression</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_86"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>closure</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_243"><a href="#prod-GeneratorExpression">GeneratorExpression</a></emu-nt>.</li><li>Return <var>closure</var>.
  </li></ol></emu-alg>
  <emu-grammar><emu-production name="GeneratorExpression" collapsed="">
    <emu-nt><a href="#prod-GeneratorExpression">GeneratorExpression</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="7dbc99b6"><emu-t>function</emu-t><emu-t>*</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt><emu-t>(</emu-t><emu-nt id="_ref_244"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-GeneratorBody">GeneratorBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>If the function code for this <emu-nt id="_ref_245"><a href="#prod-GeneratorExpression">GeneratorExpression</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>scope</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.github.io/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment.</li><li>Let <var>funcEnv</var> be <emu-xref aoid="NewDeclarativeEnvironment" id="_ref_87"><a href="https://tc39.github.io/ecma262/#sec-newdeclarativeenvironment">NewDeclarativeEnvironment</a></emu-xref>(<var>scope</var>).</li><li>Let <var>envRec</var> be <var>funcEnv</var>'s <emu-xref href="#sec-lexical-environments"><a href="https://tc39.github.io/ecma262/#sec-lexical-environments">EnvironmentRecord</a></emu-xref>.</li><li>Let <var>name</var> be StringValue of <emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>.</li><li>Perform <var>envRec</var>.CreateImmutableBinding(<var>name</var>, <emu-val>false</emu-val>).</li><li>Let <var>closure</var> be <emu-xref aoid="GeneratorFunctionCreate" id="_ref_88"><a href="https://tc39.github.io/ecma262/#sec-generatorfunctioncreate">GeneratorFunctionCreate</a></emu-xref>(<emu-const>Normal</emu-const>, <emu-nt id="_ref_246"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt>, <emu-nt><a href="https://tc39.github.io/ecma262/#prod-GeneratorBody">GeneratorBody</a></emu-nt>, <var>funcEnv</var>, <var>strict</var>).</li><li>Let <var>prototype</var> be <emu-xref aoid="ObjectCreate" id="_ref_89"><a href="https://tc39.github.io/ecma262/#sec-objectcreate">ObjectCreate</a></emu-xref>(<emu-xref href="#sec-properties-of-generator-prototype"><a href="https://tc39.github.io/ecma262/#sec-properties-of-generator-prototype">%GeneratorPrototype%</a></emu-xref>).</li><li>Perform <emu-xref aoid="DefinePropertyOrThrow" id="_ref_90"><a href="https://tc39.github.io/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>closure</var>, <code>"prototype"</code>, PropertyDescriptor{[[Value]]: <var>prototype</var>, [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>false</emu-val>}).</li><li>Perform <emu-xref aoid="SetFunctionName" id="_ref_91"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>closure</var>, <var>name</var>).</li><li>Perform <var>envRec</var>.InitializeBinding(<var>name</var>, <var>closure</var>).</li><li><ins>If the code matched by this <emu-nt id="_ref_247"><a href="#prod-GeneratorExpression">GeneratorExpression</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_92"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>closure</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_248"><a href="#prod-GeneratorExpression">GeneratorExpression</a></emu-nt>.</li><li>Return <var>closure</var>.
  </li></ol></emu-alg>
  <emu-note><span class="note">Note</span><div class="note-contents">
    <p>The <emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt> in a <emu-nt id="_ref_249"><a href="#prod-GeneratorExpression">GeneratorExpression</a></emu-nt> can be referenced from inside the <emu-nt id="_ref_250"><a href="#prod-GeneratorExpression">GeneratorExpression</a></emu-nt>'s <emu-nt><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt> to allow the generator code to call itself recursively. However, unlike in a <emu-nt id="_ref_251"><a href="#prod-GeneratorDeclaration">GeneratorDeclaration</a></emu-nt>, the <emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt> in a <emu-nt id="_ref_252"><a href="#prod-GeneratorExpression">GeneratorExpression</a></emu-nt> cannot be referenced from and does not affect the scope enclosing the <emu-nt id="_ref_253"><a href="#prod-GeneratorExpression">GeneratorExpression</a></emu-nt>.</p>
  </div></emu-note>
</emu-clause>


<emu-clause id="proposal-sec-asyncgenerator-definitions-instantiatefunctionobject">
  <h1><span class="secnum">11</span>Runtime Semantics: InstantiateFunctionObject</h1>
  <p>With parameter <var>scope</var>.</p>
  <emu-grammar><emu-production name="AsyncGeneratorDeclaration" collapsed="" id="prod-AsyncGeneratorDeclaration">
    <emu-nt><a href="#prod-AsyncGeneratorDeclaration">AsyncGeneratorDeclaration</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="cd06baed"><emu-t>async</emu-t><emu-gann>[no <emu-nt><a href="https://tc39.github.io/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann><emu-t>function</emu-t><emu-t>*</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt><emu-t>(</emu-t><emu-nt id="_ref_254"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt>AsyncGeneratorBody</emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>If the function code for <emu-nt id="_ref_255"><a href="#prod-AsyncGeneratorDeclaration">AsyncGeneratorDeclaration</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>name</var> be StringValue of <emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>.</li><li>Let <var>F</var> be !&nbsp;AsyncGeneratorFunctionCreate(<emu-const>Normal</emu-const>, <emu-nt id="_ref_256"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt>, <emu-nt>AsyncGeneratorBody</emu-nt>, <var>scope</var>, <var>strict</var>).</li><li>Let <var>prototype</var> be !&nbsp;<emu-xref aoid="ObjectCreate" id="_ref_93"><a href="https://tc39.github.io/ecma262/#sec-objectcreate">ObjectCreate</a></emu-xref>(%AsyncGeneratorPrototype%).</li><li>Perform !&nbsp;<emu-xref aoid="DefinePropertyOrThrow" id="_ref_94"><a href="https://tc39.github.io/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>F</var>, <code>"prototype"</code>, PropertyDescriptor{[[Value]]: <var>prototype</var>, [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>false</emu-val>}).</li><li>Perform !&nbsp;<emu-xref aoid="SetFunctionName" id="_ref_95"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>F</var>, <var>name</var>).</li><li><ins>If the code matched by this <emu-nt id="_ref_257"><a href="#prod-AsyncGeneratorDeclaration">AsyncGeneratorDeclaration</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_96"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>F</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_258"><a href="#prod-AsyncGeneratorDeclaration">AsyncGeneratorDeclaration</a></emu-nt>.</li><li>Return <var>F</var>.
  </li></ol></emu-alg>

  <emu-grammar><emu-production name="AsyncGeneratorDeclaration" collapsed="">
    <emu-nt><a href="#prod-AsyncGeneratorDeclaration">AsyncGeneratorDeclaration</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="905852d2"><emu-t>async</emu-t><emu-gann>[no <emu-nt><a href="https://tc39.github.io/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann><emu-t>function</emu-t><emu-t>*</emu-t><emu-t>(</emu-t><emu-nt id="_ref_259"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt>AsyncGeneratorBody</emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>If the function code for <emu-nt id="_ref_260"><a href="#prod-AsyncGeneratorDeclaration">AsyncGeneratorDeclaration</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>F</var> be AsyncGeneratorFunctionCreate(<emu-const>Normal</emu-const>, <emu-nt id="_ref_261"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt>, <emu-nt>AsyncGeneratorBody</emu-nt>, <var>scope</var>, <var>strict</var>).</li><li>Let <var>prototype</var> be <emu-xref aoid="ObjectCreate" id="_ref_97"><a href="https://tc39.github.io/ecma262/#sec-objectcreate">ObjectCreate</a></emu-xref>(%AsyncGeneratorPrototype%).</li><li>Perform <emu-xref aoid="DefinePropertyOrThrow" id="_ref_98"><a href="https://tc39.github.io/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>F</var>, <code>"prototype"</code>, PropertyDescriptor{[[Value]]: <var>prototype</var>, [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>false</emu-val>}).</li><li>Perform <emu-xref aoid="SetFunctionName" id="_ref_99"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>F</var>, <code>"default"</code>).</li><li><ins>If the code matched by this <emu-nt id="_ref_262"><a href="#prod-AsyncGeneratorDeclaration">AsyncGeneratorDeclaration</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_100"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>F</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_263"><a href="#prod-AsyncGeneratorDeclaration">AsyncGeneratorDeclaration</a></emu-nt>.</li><li>Return <var>F</var>.
  </li></ol></emu-alg>
  <emu-note><span class="note">Note</span><div class="note-contents">
    <p>An anonymous <emu-nt id="_ref_264"><a href="#prod-AsyncGeneratorDeclaration">AsyncGeneratorDeclaration</a></emu-nt> can only occur as part of an <code>export default</code> declaration.</p>
  </div></emu-note>
</emu-clause>


<emu-clause id="proposal-sec-asyncgenerator-definitions-propertydefinitionevaluation">
  <h1><span class="secnum">12</span>Runtime Semantics: PropertyDefinitionEvaluation</h1>
  <p>With parameter <var>object</var> and <var>enumerable</var>.</p>
  <emu-grammar><emu-production name="AsyncGeneratorMethod" collapsed="" id="prod-AsyncGeneratorMethod">
    <emu-nt><a href="#prod-AsyncGeneratorMethod">AsyncGeneratorMethod</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="ef6418a5"><emu-t>async</emu-t><emu-gann>[no <emu-nt><a href="https://tc39.github.io/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann><emu-t>*</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-PropertyName">PropertyName</a></emu-nt><emu-t>(</emu-t><emu-nt id="_ref_265"><a href="#prod-UniqueFormalParameters">UniqueFormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt>AsyncGeneratorBody</emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>Let <var>propKey</var> be the result of evaluating <emu-nt><a href="https://tc39.github.io/ecma262/#prod-PropertyName">PropertyName</a></emu-nt>.</li><li><emu-xref aoid="ReturnIfAbrupt" id="_ref_101"><a href="https://tc39.github.io/ecma262/#sec-returnifabrupt">ReturnIfAbrupt</a></emu-xref>(<var>propKey</var>).</li><li>If the function code for this <emu-nt id="_ref_266"><a href="#prod-AsyncGeneratorMethod">AsyncGeneratorMethod</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>scope</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.github.io/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment.</li><li>Let <var>closure</var> be !&nbsp;AsyncGeneratorFunctionCreate(<emu-const>Method</emu-const>, <emu-nt id="_ref_267"><a href="#prod-UniqueFormalParameters">UniqueFormalParameters</a></emu-nt>, <emu-nt>AsyncGeneratorBody</emu-nt>, <var>scope</var>, <var>strict</var>).</li><li>Perform !&nbsp;<emu-xref aoid="MakeMethod" id="_ref_102"><a href="https://tc39.github.io/ecma262/#sec-makemethod">MakeMethod</a></emu-xref>(<var>closure</var>, <var>object</var>).</li><li>Let <var>prototype</var> be !&nbsp;<emu-xref aoid="ObjectCreate" id="_ref_103"><a href="https://tc39.github.io/ecma262/#sec-objectcreate">ObjectCreate</a></emu-xref>(%AsyncGeneratorPrototype%).</li><li>Perform !&nbsp;<emu-xref aoid="DefinePropertyOrThrow" id="_ref_104"><a href="https://tc39.github.io/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>closure</var>, <code>"prototype"</code>, PropertyDescriptor{[[Value]]: <var>prototype</var>, [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>false</emu-val>}).</li><li>Perform !&nbsp;<emu-xref aoid="SetFunctionName" id="_ref_105"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>closure</var>, <var>propKey</var>).</li><li><ins>If the code matched by this <emu-nt id="_ref_268"><a href="#prod-AsyncGeneratorMethod">AsyncGeneratorMethod</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_106"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>closure</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_269"><a href="#prod-AsyncGeneratorMethod">AsyncGeneratorMethod</a></emu-nt>.</li><li>Let <var>desc</var> be PropertyDescriptor{[[Value]]: <var>closure</var>, [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <var>enumerable</var>, [[Configurable]]: <emu-val>true</emu-val>}.</li><li>Return ?&nbsp;<emu-xref aoid="DefinePropertyOrThrow" id="_ref_107"><a href="https://tc39.github.io/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>object</var>, <var>propKey</var>, <var>desc</var>).
  </li></ol></emu-alg>
</emu-clause>


<emu-clause id="proposal-sec-asyncgenerator-definitions-evaluation">
  <h1><span class="secnum">13</span>Runtime Semantics: Evaluation</h1>

  <emu-grammar><emu-production name="AsyncGeneratorExpression" collapsed="" id="prod-AsyncGeneratorExpression">
    <emu-nt><a href="#prod-AsyncGeneratorExpression">AsyncGeneratorExpression</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="905852d2"><emu-t>async</emu-t><emu-gann>[no <emu-nt><a href="https://tc39.github.io/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann><emu-t>function</emu-t><emu-t>*</emu-t><emu-t>(</emu-t><emu-nt id="_ref_270"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt>AsyncGeneratorBody</emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>If the function code for this <emu-nt id="_ref_271"><a href="#prod-AsyncGeneratorExpression">AsyncGeneratorExpression</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>scope</var> be the LexicalEnvironment of the <emu-xref href="#running-execution-context"><a href="https://tc39.github.io/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Let <var>closure</var> be !&nbsp;AsyncGeneratorFunctionCreate(<emu-const>Normal</emu-const>, <emu-nt id="_ref_272"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt>, <emu-nt>AsyncGeneratorBody</emu-nt>, <var>scope</var>, <var>strict</var>).</li><li>Let <var>prototype</var> be !&nbsp;<emu-xref aoid="ObjectCreate" id="_ref_108"><a href="https://tc39.github.io/ecma262/#sec-objectcreate">ObjectCreate</a></emu-xref>(%AsyncGeneratorPrototype%).</li><li>Perform !&nbsp;<emu-xref aoid="DefinePropertyOrThrow" id="_ref_109"><a href="https://tc39.github.io/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>closure</var>, <code>"prototype"</code>, PropertyDescriptor{[[Value]]: <var>prototype</var>, [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>false</emu-val>}).</li><li><ins>If the code matched by this <emu-nt id="_ref_273"><a href="#prod-AsyncGeneratorExpression">AsyncGeneratorExpression</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_110"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>closure</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_274"><a href="#prod-AsyncGeneratorExpression">AsyncGeneratorExpression</a></emu-nt>.</li><li>Return <var>closure</var>.
  </li></ol></emu-alg>

  <emu-grammar><emu-production name="AsyncGeneratorExpression" collapsed="">
    <emu-nt><a href="#prod-AsyncGeneratorExpression">AsyncGeneratorExpression</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="cd06baed"><emu-t>async</emu-t><emu-gann>[no <emu-nt><a href="https://tc39.github.io/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann><emu-t>function</emu-t><emu-t>*</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt><emu-t>(</emu-t><emu-nt id="_ref_275"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt>AsyncGeneratorBody</emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>If the function code for this <emu-nt id="_ref_276"><a href="#prod-AsyncGeneratorExpression">AsyncGeneratorExpression</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>scope</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.github.io/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment.</li><li>Let <var>funcEnv</var> be !&nbsp;<emu-xref aoid="NewDeclarativeEnvironment" id="_ref_111"><a href="https://tc39.github.io/ecma262/#sec-newdeclarativeenvironment">NewDeclarativeEnvironment</a></emu-xref>(<var>scope</var>).</li><li>Let <var>envRec</var> be <var>funcEnv</var>'s <emu-xref href="#sec-lexical-environments"><a href="https://tc39.github.io/ecma262/#sec-lexical-environments">EnvironmentRecord</a></emu-xref>.</li><li>Let <var>name</var> be StringValue of <emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>.</li><li>Perform ! <var>envRec</var>.CreateImmutableBinding(<var>name</var>).</li><li>Let <var>closure</var> be !&nbsp;AsyncGeneratorFunctionCreate(<emu-const>Normal</emu-const>, <emu-nt id="_ref_277"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt>, <emu-nt>AsyncGeneratorBody</emu-nt>, <var>funcEnv</var>, <var>strict</var>).</li><li>Let <var>prototype</var> be !&nbsp;<emu-xref aoid="ObjectCreate" id="_ref_112"><a href="https://tc39.github.io/ecma262/#sec-objectcreate">ObjectCreate</a></emu-xref>(%AsyncGeneratorPrototype%).</li><li>Perform !&nbsp;<emu-xref aoid="DefinePropertyOrThrow" id="_ref_113"><a href="https://tc39.github.io/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>closure</var>, <code>"prototype"</code>, PropertyDescriptor{[[Value]]: <var>prototype</var>, [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>false</emu-val>}).</li><li>Perform !&nbsp;<emu-xref aoid="SetFunctionName" id="_ref_114"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>closure</var>, <var>name</var>).</li><li>Perform ! <var>envRec</var>.InitializeBinding(<var>name</var>, <var>closure</var>).</li><li><ins>If the code matched by this <emu-nt id="_ref_278"><a href="#prod-AsyncGeneratorExpression">AsyncGeneratorExpression</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_115"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>closure</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_279"><a href="#prod-AsyncGeneratorExpression">AsyncGeneratorExpression</a></emu-nt>.</li><li>Return <var>closure</var>.
  </li></ol></emu-alg>
  <emu-note><span class="note">Note</span><div class="note-contents">
    <p>The <emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt> in an <emu-nt id="_ref_280"><a href="#prod-AsyncGeneratorExpression">AsyncGeneratorExpression</a></emu-nt> can be referenced from inside the <emu-nt id="_ref_281"><a href="#prod-AsyncGeneratorExpression">AsyncGeneratorExpression</a></emu-nt>'s <emu-nt>AsyncGeneratorBody</emu-nt> to allow the generator code to call itself recursively. However, unlike in an <emu-nt id="_ref_282"><a href="#prod-AsyncGeneratorDeclaration">AsyncGeneratorDeclaration</a></emu-nt>, the <emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt> in an <emu-nt id="_ref_283"><a href="#prod-AsyncGeneratorExpression">AsyncGeneratorExpression</a></emu-nt> cannot be referenced from and does not affect the scope enclosing the <emu-nt id="_ref_284"><a href="#prod-AsyncGeneratorExpression">AsyncGeneratorExpression</a></emu-nt>.</p>
  </div></emu-note>
</emu-clause>


<emu-clause id="proposal-sec-runtime-semantics-bindingclassdeclarationevaluation">
  <h1><span class="secnum">14</span>Runtime Semantics: BindingClassDeclarationEvaluation</h1>
  <emu-grammar><emu-production name="ClassDeclaration" collapsed="" id="prod-ClassDeclaration">
    <emu-nt><a href="#prod-ClassDeclaration">ClassDeclaration</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="4ee4ae5a"><emu-t>class</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt><emu-nt><a href="https://tc39.github.io/ecma262/#prod-ClassTail">ClassTail</a></emu-nt></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>Let <var>className</var> be StringValue of <emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>.</li><li>Let <var>value</var> be the result of ClassDefinitionEvaluation of <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ClassTail">ClassTail</a></emu-nt> with argument <var>className</var>.</li><li><emu-xref aoid="ReturnIfAbrupt" id="_ref_116"><a href="https://tc39.github.io/ecma262/#sec-returnifabrupt">ReturnIfAbrupt</a></emu-xref>(<var>value</var>).</li><li>Let <var>hasNameProperty</var> be ?&nbsp;<emu-xref aoid="HasOwnProperty" id="_ref_117"><a href="https://tc39.github.io/ecma262/#sec-hasownproperty">HasOwnProperty</a></emu-xref>(<var>value</var>, <code>"name"</code>).</li><li>If <var>hasNameProperty</var> is <emu-val>false</emu-val>, perform <emu-xref aoid="SetFunctionName" id="_ref_118"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>value</var>, <var>className</var>).</li><li><ins>If the code matched by this <emu-nt id="_ref_285"><a href="#prod-ClassDeclaration">ClassDeclaration</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_119"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>value</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_286"><a href="#prod-ClassDeclaration">ClassDeclaration</a></emu-nt>.</li><li>Let <var>env</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.github.io/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment.</li><li>Perform ?&nbsp;<emu-xref aoid="InitializeBoundName" id="_ref_120"><a href="https://tc39.github.io/ecma262/#sec-initializeboundname">InitializeBoundName</a></emu-xref>(<var>className</var>, <var>value</var>, <var>env</var>).</li><li>Return <var>value</var>.
  </li></ol></emu-alg>
  <emu-grammar><emu-production name="ClassDeclaration" collapsed="">
    <emu-nt><a href="#prod-ClassDeclaration">ClassDeclaration</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="d461f28b"><emu-t>class</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-ClassTail">ClassTail</a></emu-nt></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>Let <var>value</var> be the result of ClassDefinitionEvaluation of <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ClassTail">ClassTail</a></emu-nt> with argument <emu-val>undefined</emu-val>.</li><li><ins>If the code matched by this <emu-nt id="_ref_287"><a href="#prod-ClassDeclaration">ClassDeclaration</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_121"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>value</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_288"><a href="#prod-ClassDeclaration">ClassDeclaration</a></emu-nt>.</li><li>Return <var>value</var>.
  </li></ol></emu-alg>
  <emu-note><span class="note">Note</span><div class="note-contents">
    <p><emu-grammar><emu-production name="ClassDeclaration" collapsed="" class=" inline">
    <emu-nt><a href="#prod-ClassDeclaration">ClassDeclaration</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="d461f28b"><emu-t>class</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-ClassTail">ClassTail</a></emu-nt></emu-rhs>
</emu-production></emu-grammar> only occurs as part of an <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ExportDeclaration">ExportDeclaration</a></emu-nt> and the setting of a name property and establishing its binding are handled as part of the evaluation action for that production. See  <emu-xref href="#sec-exports-runtime-semantics-evaluation"><a href="https://tc39.github.io/ecma262/#sec-exports-runtime-semantics-evaluation">15.2.3.9</a></emu-xref>.</p>
  </div></emu-note>
</emu-clause>

<emu-clause id="proposal-sec-class-definitions-runtime-semantics-evaluation">
  <h1><span class="secnum">15</span>Runtime Semantics: Evaluation</h1>
  <emu-grammar><emu-production name="ClassDeclaration" collapsed="">
    <emu-nt><a href="#prod-ClassDeclaration">ClassDeclaration</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="4ee4ae5a"><emu-t>class</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt><emu-nt><a href="https://tc39.github.io/ecma262/#prod-ClassTail">ClassTail</a></emu-nt></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>Let <var>status</var> be the result of BindingClassDeclarationEvaluation of this <emu-nt id="_ref_289"><a href="#prod-ClassDeclaration">ClassDeclaration</a></emu-nt>.</li><li><emu-xref aoid="ReturnIfAbrupt" id="_ref_122"><a href="https://tc39.github.io/ecma262/#sec-returnifabrupt">ReturnIfAbrupt</a></emu-xref>(<var>status</var>).</li><li>Return <emu-xref aoid="NormalCompletion" id="_ref_123"><a href="https://tc39.github.io/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<emu-const>empty</emu-const>).
  </li></ol></emu-alg>
  <emu-note><span class="note">Note 1</span><div class="note-contents">
    <p><emu-grammar><emu-production name="ClassDeclaration" collapsed="" class=" inline">
    <emu-nt><a href="#prod-ClassDeclaration">ClassDeclaration</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="d461f28b"><emu-t>class</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-ClassTail">ClassTail</a></emu-nt></emu-rhs>
</emu-production></emu-grammar> only occurs as part of an <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ExportDeclaration">ExportDeclaration</a></emu-nt> and is never directly evaluated.</p>
  </div></emu-note>
  <emu-grammar><emu-production name="ClassExpression" collapsed="" id="prod-ClassExpression">
    <emu-nt><a href="#prod-ClassExpression">ClassExpression</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="d022e28b"><emu-t>class</emu-t><emu-nt optional=""><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a><emu-mods><emu-opt>opt</emu-opt></emu-mods></emu-nt><emu-nt><a href="https://tc39.github.io/ecma262/#prod-ClassTail">ClassTail</a></emu-nt></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>If <emu-nt optional=""><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a><emu-mods><emu-opt>opt</emu-opt></emu-mods></emu-nt> is not present, let <var>className</var> be <emu-val>undefined</emu-val>.</li><li>Else, let <var>className</var> be StringValue of <emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>.</li><li>Let <var>value</var> be the result of ClassDefinitionEvaluation of <emu-nt><a href="https://tc39.github.io/ecma262/#prod-ClassTail">ClassTail</a></emu-nt> with argument <var>className</var>.</li><li><emu-xref aoid="ReturnIfAbrupt" id="_ref_124"><a href="https://tc39.github.io/ecma262/#sec-returnifabrupt">ReturnIfAbrupt</a></emu-xref>(<var>value</var>).</li><li>If <var>className</var> is not <emu-val>undefined</emu-val>, then<ol><li>Let <var>hasNameProperty</var> be ?&nbsp;<emu-xref aoid="HasOwnProperty" id="_ref_125"><a href="https://tc39.github.io/ecma262/#sec-hasownproperty">HasOwnProperty</a></emu-xref>(<var>value</var>, <code>"name"</code>).</li><li>If <var>hasNameProperty</var> is <emu-val>false</emu-val>, then<ol><li>Perform <emu-xref aoid="SetFunctionName" id="_ref_126"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>value</var>, <var>className</var>).</li></ol></li></ol></li><li><ins>If the code matched by this <emu-nt id="_ref_290"><a href="#prod-ClassExpression">ClassExpression</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_127"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>value</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_291"><a href="#prod-ClassExpression">ClassExpression</a></emu-nt>.</li><li>Return <emu-xref aoid="NormalCompletion" id="_ref_128"><a href="https://tc39.github.io/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<var>value</var>).
  </li></ol></emu-alg>
  <emu-note><span class="note">Note 2</span><div class="note-contents">
    <p>If the class definition included a <code>name</code> static method then that method is not over-written with a <code>name</code> data property for the class name.</p>
  </div></emu-note>
</emu-clause>


<emu-clause id="proposal-sec-async-function-definitions-InstantiateFunctionObject">
  <h1><span class="secnum">16</span>Runtime Semantics: InstantiateFunctionObject</h1>
  <p>With parameter <var>scope</var>.</p>
  <emu-grammar><emu-production name="AsyncFunctionDeclaration" collapsed="" id="prod-AsyncFunctionDeclaration">
    <emu-nt><a href="#prod-AsyncFunctionDeclaration">AsyncFunctionDeclaration</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="6767e0c7"><emu-t>async</emu-t><emu-gann>[no <emu-nt><a href="https://tc39.github.io/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann><emu-t>function</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt><emu-t>(</emu-t><emu-nt id="_ref_292"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-AsyncFunctionBody">AsyncFunctionBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>If the function code for <emu-nt id="_ref_293"><a href="#prod-AsyncFunctionDeclaration">AsyncFunctionDeclaration</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise, let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>name</var> be StringValue of <emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>.</li><li>Let <var>F</var> be !&nbsp;<emu-xref aoid="AsyncFunctionCreate" id="_ref_129"><a href="https://tc39.github.io/ecma262/#sec-async-functions-abstract-operations-async-function-create">AsyncFunctionCreate</a></emu-xref>(<emu-const>Normal</emu-const>, <emu-nt id="_ref_294"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt>, <emu-nt><a href="https://tc39.github.io/ecma262/#prod-AsyncFunctionBody">AsyncFunctionBody</a></emu-nt>, <var>scope</var>, <var>strict</var>).</li><li>Perform !&nbsp;<emu-xref aoid="SetFunctionName" id="_ref_130"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>F</var>, <var>name</var>).</li><li><ins>If the code matched by this <emu-nt id="_ref_295"><a href="#prod-AsyncFunctionDeclaration">AsyncFunctionDeclaration</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_131"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>F</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_296"><a href="#prod-AsyncFunctionDeclaration">AsyncFunctionDeclaration</a></emu-nt>.</li><li>Return <var>F</var>.
  </li></ol></emu-alg>
  <emu-grammar><emu-production name="AsyncFunctionDeclaration" collapsed="">
    <emu-nt><a href="#prod-AsyncFunctionDeclaration">AsyncFunctionDeclaration</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="6d58af42"><emu-t>async</emu-t><emu-gann>[no <emu-nt><a href="https://tc39.github.io/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann><emu-t>function</emu-t><emu-t>(</emu-t><emu-nt id="_ref_297"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-AsyncFunctionBody">AsyncFunctionBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>If the function code for <emu-nt id="_ref_298"><a href="#prod-AsyncFunctionDeclaration">AsyncFunctionDeclaration</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise, let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>F</var> be !&nbsp;<emu-xref aoid="AsyncFunctionCreate" id="_ref_132"><a href="https://tc39.github.io/ecma262/#sec-async-functions-abstract-operations-async-function-create">AsyncFunctionCreate</a></emu-xref>(<emu-const>Normal</emu-const>, <emu-nt id="_ref_299"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt>, <emu-nt><a href="https://tc39.github.io/ecma262/#prod-AsyncFunctionBody">AsyncFunctionBody</a></emu-nt>, <var>scope</var>, <var>strict</var>).</li><li>Perform !&nbsp;<emu-xref aoid="SetFunctionName" id="_ref_133"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>F</var>, <code>"default"</code>).</li><li><ins>If the code matched by this <emu-nt id="_ref_300"><a href="#prod-AsyncFunctionDeclaration">AsyncFunctionDeclaration</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_134"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>F</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_301"><a href="#prod-AsyncFunctionDeclaration">AsyncFunctionDeclaration</a></emu-nt>.</li><li>Return <var>F</var>.
  </li></ol></emu-alg>
</emu-clause>


<emu-clause id="proposal-sec-async-function-definitions-PropertyDefinitionEvaluation">
  <h1><span class="secnum">17</span>Runtime Semantics: PropertyDefinitionEvaluation</h1>
  <p>With parameters <var>object</var> and <var>enumerable</var>.</p>
  <emu-grammar><emu-production name="AsyncMethod" collapsed="" id="prod-AsyncMethod">
    <emu-nt><a href="#prod-AsyncMethod">AsyncMethod</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="7d771781"><emu-t>async</emu-t><emu-gann>[no <emu-nt><a href="https://tc39.github.io/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann><emu-nt><a href="https://tc39.github.io/ecma262/#prod-PropertyName">PropertyName</a></emu-nt><emu-t>(</emu-t><emu-nt id="_ref_302"><a href="#prod-UniqueFormalParameters">UniqueFormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-AsyncFunctionBody">AsyncFunctionBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>Let <var>propKey</var> be the result of evaluating <emu-nt><a href="https://tc39.github.io/ecma262/#prod-PropertyName">PropertyName</a></emu-nt>.</li><li><emu-xref aoid="ReturnIfAbrupt" id="_ref_135"><a href="https://tc39.github.io/ecma262/#sec-returnifabrupt">ReturnIfAbrupt</a></emu-xref>(<var>propKey</var>).</li><li>If the function code for this <emu-nt id="_ref_303"><a href="#prod-AsyncMethod">AsyncMethod</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>scope</var> be the LexicalEnvironment of the <emu-xref href="#running-execution-context"><a href="https://tc39.github.io/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Let <var>closure</var> be !&nbsp;<emu-xref aoid="AsyncFunctionCreate" id="_ref_136"><a href="https://tc39.github.io/ecma262/#sec-async-functions-abstract-operations-async-function-create">AsyncFunctionCreate</a></emu-xref>(<emu-const>Method</emu-const>, <emu-nt id="_ref_304"><a href="#prod-UniqueFormalParameters">UniqueFormalParameters</a></emu-nt>, <emu-nt><a href="https://tc39.github.io/ecma262/#prod-AsyncFunctionBody">AsyncFunctionBody</a></emu-nt>, <var>scope</var>, <var>strict</var>).</li><li>Perform !&nbsp;<emu-xref aoid="MakeMethod" id="_ref_137"><a href="https://tc39.github.io/ecma262/#sec-makemethod">MakeMethod</a></emu-xref>(<var>closure</var>, <var>object</var>).</li><li>Perform !&nbsp;<emu-xref aoid="SetFunctionName" id="_ref_138"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>closure</var>, <var>propKey</var>).</li><li><ins>If the code matched by this <emu-nt id="_ref_305"><a href="#prod-AsyncMethod">AsyncMethod</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_139"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>closure</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_306"><a href="#prod-AsyncMethod">AsyncMethod</a></emu-nt>.</li><li>Let <var>desc</var> be the PropertyDescriptor{[[Value]]: <var>closure</var>, [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <var>enumerable</var>, [[Configurable]]: <emu-val>true</emu-val>}.</li><li>Return ?&nbsp;<emu-xref aoid="DefinePropertyOrThrow" id="_ref_140"><a href="https://tc39.github.io/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>object</var>, <var>propKey</var>, <var>desc</var>).
  </li></ol></emu-alg>
</emu-clause>


<emu-clause id="proposal-sec-async-function-definitions-runtime-semantics-evaluation">
  <h1><span class="secnum">18</span>Runtime Semantics: Evaluation</h1>
  <emu-grammar><emu-production name="AsyncFunctionDeclaration" collapsed="">
    <emu-nt><a href="#prod-AsyncFunctionDeclaration">AsyncFunctionDeclaration</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="6767e0c7"><emu-t>async</emu-t><emu-gann>[no <emu-nt><a href="https://tc39.github.io/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann><emu-t>function</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt><emu-t>(</emu-t><emu-nt id="_ref_307"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-AsyncFunctionBody">AsyncFunctionBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>Return <emu-xref aoid="NormalCompletion" id="_ref_141"><a href="https://tc39.github.io/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<emu-const>empty</emu-const>).
  </li></ol></emu-alg>

  <emu-grammar><emu-production name="AsyncFunctionDeclaration" collapsed="">
    <emu-nt><a href="#prod-AsyncFunctionDeclaration">AsyncFunctionDeclaration</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="6d58af42"><emu-t>async</emu-t><emu-gann>[no <emu-nt><a href="https://tc39.github.io/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann><emu-t>function</emu-t><emu-t>(</emu-t><emu-nt id="_ref_308"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-AsyncFunctionBody">AsyncFunctionBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>Return <emu-xref aoid="NormalCompletion" id="_ref_142"><a href="https://tc39.github.io/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<emu-const>empty</emu-const>).
  </li></ol></emu-alg>

  <emu-grammar><emu-production name="AsyncFunctionExpression" collapsed="" id="prod-AsyncFunctionExpression">
    <emu-nt><a href="#prod-AsyncFunctionExpression">AsyncFunctionExpression</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="6d58af42"><emu-t>async</emu-t><emu-gann>[no <emu-nt><a href="https://tc39.github.io/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann><emu-t>function</emu-t><emu-t>(</emu-t><emu-nt id="_ref_309"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-AsyncFunctionBody">AsyncFunctionBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>If the function code for <emu-nt id="_ref_310"><a href="#prod-AsyncFunctionExpression">AsyncFunctionExpression</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>scope</var> be the LexicalEnvironment of the <emu-xref href="#running-execution-context"><a href="https://tc39.github.io/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Let <var>closure</var> be !&nbsp;<emu-xref aoid="AsyncFunctionCreate" id="_ref_143"><a href="https://tc39.github.io/ecma262/#sec-async-functions-abstract-operations-async-function-create">AsyncFunctionCreate</a></emu-xref>(<emu-const>Normal</emu-const>, <emu-nt id="_ref_311"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt>, <emu-nt><a href="https://tc39.github.io/ecma262/#prod-AsyncFunctionBody">AsyncFunctionBody</a></emu-nt>, <var>scope</var>, <var>strict</var>).</li><li><ins>If the code matched by this <emu-nt id="_ref_312"><a href="#prod-AsyncFunctionExpression">AsyncFunctionExpression</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_144"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>closure</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_313"><a href="#prod-AsyncFunctionExpression">AsyncFunctionExpression</a></emu-nt>.</li><li>Return <var>closure</var>.
  </li></ol></emu-alg>

  <emu-grammar><emu-production name="AsyncFunctionExpression" collapsed="">
    <emu-nt><a href="#prod-AsyncFunctionExpression">AsyncFunctionExpression</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="6767e0c7"><emu-t>async</emu-t><emu-gann>[no <emu-nt><a href="https://tc39.github.io/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann><emu-t>function</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt><emu-t>(</emu-t><emu-nt id="_ref_314"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt><emu-t>)</emu-t><emu-t>{</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-AsyncFunctionBody">AsyncFunctionBody</a></emu-nt><emu-t>}</emu-t></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>If the function code for <emu-nt id="_ref_315"><a href="#prod-AsyncFunctionExpression">AsyncFunctionExpression</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>scope</var> be the LexicalEnvironment of the <emu-xref href="#running-execution-context"><a href="https://tc39.github.io/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Let <var>funcEnv</var> be !&nbsp;<emu-xref aoid="NewDeclarativeEnvironment" id="_ref_145"><a href="https://tc39.github.io/ecma262/#sec-newdeclarativeenvironment">NewDeclarativeEnvironment</a></emu-xref>(<var>scope</var>).</li><li>Let <var>envRec</var> be <var>funcEnv</var>'s <emu-xref href="#sec-lexical-environments"><a href="https://tc39.github.io/ecma262/#sec-lexical-environments">EnvironmentRecord</a></emu-xref>.</li><li>Let <var>name</var> be StringValue of <emu-nt><a href="https://tc39.github.io/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>.</li><li>Perform ! <var>envRec</var>.CreateImmutableBinding(<var>name</var>).</li><li>Let <var>closure</var> be !&nbsp;<emu-xref aoid="AsyncFunctionCreate" id="_ref_146"><a href="https://tc39.github.io/ecma262/#sec-async-functions-abstract-operations-async-function-create">AsyncFunctionCreate</a></emu-xref>(<emu-const>Normal</emu-const>, <emu-nt id="_ref_316"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt>, <emu-nt><a href="https://tc39.github.io/ecma262/#prod-AsyncFunctionBody">AsyncFunctionBody</a></emu-nt>, <var>funcEnv</var>, <var>strict</var>).</li><li>Perform !&nbsp;<emu-xref aoid="SetFunctionName" id="_ref_147"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>closure</var>, <var>name</var>).</li><li>Perform ! <var>envRec</var>.InitializeBinding(<var>name</var>, <var>closure</var>).</li><li><ins>If the code matched by this <emu-nt id="_ref_317"><a href="#prod-AsyncFunctionExpression">AsyncFunctionExpression</a></emu-nt> is not <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_148"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, </ins>set <var>closure</var>.[[SourceText]] to the source text matched by <emu-nt id="_ref_318"><a href="#prod-AsyncFunctionExpression">AsyncFunctionExpression</a></emu-nt>.</li><li>Return <var>closure</var>.
  </li></ol></emu-alg>

  <emu-grammar><emu-production name="AwaitExpression" collapsed="" id="prod-AwaitExpression">
    <emu-nt><a href="#prod-AwaitExpression">AwaitExpression</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="ef22da1b"><emu-t>await</emu-t><emu-nt><a href="https://tc39.github.io/ecma262/#prod-UnaryExpression">UnaryExpression</a></emu-nt></emu-rhs>
</emu-production></emu-grammar>
  <emu-alg><ol><li>Let <var>exprRef</var> be the result of evaluating <emu-nt><a href="https://tc39.github.io/ecma262/#prod-UnaryExpression">UnaryExpression</a></emu-nt>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="GetValue" id="_ref_149"><a href="https://tc39.github.io/ecma262/#sec-getvalue">GetValue</a></emu-xref>(<var>exprRef</var>).</li><li>Return ?&nbsp;Await(<var>value</var>).
  </li></ol></emu-alg>
</emu-clause>


<!-- es6num="19.2.1.1.1" -->
<emu-clause id="proposal-sec-createdynamicfunction" aoid="CreateDynamicFunction">
  <h1><span class="secnum">19</span>Runtime Semantics: CreateDynamicFunction( <var>constructor</var>, <var>newTarget</var>, <var>kind</var>, <var>args</var> )</h1>
  <p>The abstract operation CreateDynamicFunction is called with arguments <var>constructor</var>, <var>newTarget</var>, <var>kind</var>, and <var>args</var>. <var>constructor</var> is the constructor function that is performing this action, <var>newTarget</var> is the constructor that <code>new</code> was initially applied to, <var>kind</var> is either <code>"normal"</code>, <code>"generator"</code>, or <code>"async"</code>, and <var>args</var> is a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.github.io/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> containing the actual argument values that were passed to <var>constructor</var>. The following steps are taken:</p>
  <emu-alg><ol><li>Assert: The <emu-xref href="#execution-context-stack"><a href="https://tc39.github.io/ecma262/#execution-context-stack">execution context stack</a></emu-xref> has at least two elements.</li><li>Let <var>callerContext</var> be the second to top element of the <emu-xref href="#execution-context-stack"><a href="https://tc39.github.io/ecma262/#execution-context-stack">execution context stack</a></emu-xref>.</li><li>Let <var>callerRealm</var> be <var>callerContext</var>'s <emu-xref href="#realm"><a href="https://tc39.github.io/ecma262/#realm">Realm</a></emu-xref>.</li><li>Let <var>calleeRealm</var> be <emu-xref href="#current-realm"><a href="https://tc39.github.io/ecma262/#current-realm">the current Realm Record</a></emu-xref>.</li><li>Perform ?&nbsp;<emu-xref aoid="HostEnsureCanCompileStrings" id="_ref_150"><a href="https://tc39.github.io/ecma262/#sec-hostensurecancompilestrings">HostEnsureCanCompileStrings</a></emu-xref>(<var>callerRealm</var>, <var>calleeRealm</var>).</li><li>If <var>newTarget</var> is <emu-val>undefined</emu-val>, let <var>newTarget</var> be <var>constructor</var>.</li><li>If <var>kind</var> is <code>"normal"</code>, then<ol><li>Let <var>goal</var> be the grammar symbol <emu-nt params="~Yield, ~Await"><a href="https://tc39.github.io/ecma262/#prod-FunctionBody">FunctionBody</a><emu-mods><emu-params>[~Yield, ~Await]</emu-params></emu-mods></emu-nt>.</li><li>Let <var>parameterGoal</var> be the grammar symbol <emu-nt params="~Yield, ~Await" id="_ref_319"><a href="#prod-FormalParameters">FormalParameters</a><emu-mods><emu-params>[~Yield, ~Await]</emu-params></emu-mods></emu-nt>.</li><li>Let <var>fallbackProto</var> be <code>"%FunctionPrototype%"</code>.</li></ol></li><li>Else if <var>kind</var> is <code>"generator"</code>, then<ol><li>Let <var>goal</var> be the grammar symbol <emu-nt><a href="https://tc39.github.io/ecma262/#prod-GeneratorBody">GeneratorBody</a></emu-nt>.</li><li>Let <var>parameterGoal</var> be the grammar symbol <emu-nt params="+Yield, ~Await" id="_ref_320"><a href="#prod-FormalParameters">FormalParameters</a><emu-mods><emu-params>[+Yield, ~Await]</emu-params></emu-mods></emu-nt>.</li><li>Let <var>fallbackProto</var> be <code>"%Generator%"</code>.</li></ol></li><li>Else,<ol><li>Assert: <var>kind</var> is <code>"async"</code>.</li><li>Let <var>goal</var> be the grammar symbol <emu-nt><a href="https://tc39.github.io/ecma262/#prod-AsyncFunctionBody">AsyncFunctionBody</a></emu-nt>.</li><li>Let <var>parameterGoal</var> be the grammar symbol <emu-nt params="~Yield, +Await" id="_ref_321"><a href="#prod-FormalParameters">FormalParameters</a><emu-mods><emu-params>[~Yield, +Await]</emu-params></emu-mods></emu-nt>.</li><li>Let <var>fallbackProto</var> be <code>"%AsyncFunctionPrototype%"</code>.</li></ol></li><li>Let <var>argCount</var> be the number of elements in <var>args</var>.</li><li>Let <var>P</var> be the empty String.</li><li>If <var>argCount</var> = 0, let <var>bodyText</var> be the empty String.</li><li>Else if <var>argCount</var> = 1, let <var>bodyText</var> be <var>args</var>[0].</li><li>Else <var>argCount</var> &gt; 1,<ol><li>Let <var>firstArg</var> be <var>args</var>[0].</li><li>Let <var>P</var> be ?&nbsp;<emu-xref aoid="ToString" id="_ref_151"><a href="https://tc39.github.io/ecma262/#sec-tostring">ToString</a></emu-xref>(<var>firstArg</var>).</li><li>Let <var>k</var> be 1.</li><li>Repeat, while <var>k</var> &lt; <var>argCount</var>-1<ol><li>Let <var>nextArg</var> be <var>args</var>[<var>k</var>].</li><li>Let <var>nextArgString</var> be ?&nbsp;<emu-xref aoid="ToString" id="_ref_152"><a href="https://tc39.github.io/ecma262/#sec-tostring">ToString</a></emu-xref>(<var>nextArg</var>).</li><li>Let <var>P</var> be the result of concatenating the previous value of <var>P</var>, the String <code>","</code> (a comma), and <var>nextArgString</var>.</li><li>Increase <var>k</var> by 1.</li></ol></li><li>Let <var>bodyText</var> be <var>args</var>[<var>k</var>].</li></ol></li><li>Let <var>bodyText</var> be ?&nbsp;<emu-xref aoid="ToString" id="_ref_153"><a href="https://tc39.github.io/ecma262/#sec-tostring">ToString</a></emu-xref>(<var>bodyText</var>).</li><li>Let <var>parameters</var> be the result of parsing <var>P</var>, interpreted as UTF-16 encoded Unicode text as described in <emu-xref href="#sec-ecmascript-language-types-string-type"><a href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type">6.1.4</a></emu-xref>, using <var>parameterGoal</var> as the <emu-xref href="#sec-context-free-grammars"><a href="https://tc39.github.io/ecma262/#sec-context-free-grammars">goal symbol</a></emu-xref>. Throw a <emu-val>SyntaxError</emu-val> exception if the parse fails.</li><li>Let <var>body</var> be the result of parsing <var>bodyText</var>, interpreted as UTF-16 encoded Unicode text as described in <emu-xref href="#sec-ecmascript-language-types-string-type"><a href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type">6.1.4</a></emu-xref>, using <var>goal</var> as the <emu-xref href="#sec-context-free-grammars"><a href="https://tc39.github.io/ecma262/#sec-context-free-grammars">goal symbol</a></emu-xref>. Throw a <emu-val>SyntaxError</emu-val> exception if the parse fails.</li><li>If <var>bodyText</var> is <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.github.io/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, then let <var>strict</var> be <emu-val>true</emu-val>, else let <var>strict</var> be <emu-val>false</emu-val>.</li><li><ins>If <var>bodyText</var> is <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_154"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>, then let <var>noSourceText</var> be <emu-val>true</emu-val>, else let <var>noSourceText</var> be false.</ins></li><li>If any static semantics errors are detected for <var>parameters</var> or <var>body</var>, throw a <emu-val>SyntaxError</emu-val> or a <emu-val>ReferenceError</emu-val> exception, depending on the type of the error. If <var>strict</var> is <emu-val>true</emu-val>, the Early Error rules for <emu-grammar><emu-production name="UniqueFormalParameters" collapsed="" id="prod-UniqueFormalParameters" class=" inline">
    <emu-nt><a href="#prod-UniqueFormalParameters">UniqueFormalParameters</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="0218c6f5"><emu-nt id="_ref_322"><a href="#prod-FormalParameters">FormalParameters</a></emu-nt></emu-rhs>
</emu-production></emu-grammar> are applied. Parsing and <emu-xref href="#early-error"><a href="https://tc39.github.io/ecma262/#early-error">early error</a></emu-xref> detection may be interweaved in an implementation dependent manner.</li><li>If ContainsUseStrict of <var>body</var> is <emu-val>true</emu-val> and IsSimpleParameterList of <var>parameters</var> is <emu-val>false</emu-val>, throw a <emu-val>SyntaxError</emu-val> exception.</li><li>If any element of the BoundNames of <var>parameters</var> also occurs in the LexicallyDeclaredNames of <var>body</var>, throw a <emu-val>SyntaxError</emu-val> exception.</li><li>If <var>body</var> Contains <emu-nt><a href="https://tc39.github.io/ecma262/#prod-SuperCall">SuperCall</a></emu-nt> is <emu-val>true</emu-val>, throw a <emu-val>SyntaxError</emu-val> exception.</li><li>If <var>parameters</var> Contains <emu-nt><a href="https://tc39.github.io/ecma262/#prod-SuperCall">SuperCall</a></emu-nt> is <emu-val>true</emu-val>, throw a <emu-val>SyntaxError</emu-val> exception.</li><li>If <var>body</var> Contains <emu-nt><a href="https://tc39.github.io/ecma262/#prod-SuperProperty">SuperProperty</a></emu-nt> is <emu-val>true</emu-val>, throw a <emu-val>SyntaxError</emu-val> exception.</li><li>If <var>parameters</var> Contains <emu-nt><a href="https://tc39.github.io/ecma262/#prod-SuperProperty">SuperProperty</a></emu-nt> is <emu-val>true</emu-val>, throw a <emu-val>SyntaxError</emu-val> exception.</li><li>If <var>kind</var> is <code>"generator"</code>, then<ol><li>If <var>parameters</var> Contains <emu-nt><a href="https://tc39.github.io/ecma262/#prod-YieldExpression">YieldExpression</a></emu-nt> is <emu-val>true</emu-val>, throw a <emu-val>SyntaxError</emu-val> exception.</li></ol></li><li>If <var>kind</var> is <code>"async"</code>, then<ol><li>If <var>parameters</var> Contains <emu-nt id="_ref_323"><a href="#prod-AwaitExpression">AwaitExpression</a></emu-nt> is <emu-val>true</emu-val>, throw a <emu-val>SyntaxError</emu-val> exception.</li></ol></li><li>If <var>strict</var> is <emu-val>true</emu-val>, then<ol><li>If BoundNames of <var>parameters</var> contains any duplicate elements, throw a <emu-val>SyntaxError</emu-val> exception.</li></ol></li><li>Let <var>proto</var> be ?&nbsp;<emu-xref aoid="GetPrototypeFromConstructor" id="_ref_155"><a href="https://tc39.github.io/ecma262/#sec-getprototypefromconstructor">GetPrototypeFromConstructor</a></emu-xref>(<var>newTarget</var>, <var>fallbackProto</var>).</li><li>Let <var>F</var> be <emu-xref aoid="FunctionAllocate" id="_ref_156"><a href="https://tc39.github.io/ecma262/#sec-functionallocate">FunctionAllocate</a></emu-xref>(<var>proto</var>, <var>strict</var>, <var>kind</var>).</li><li>Let <var>realmF</var> be <var>F</var>.[[Realm]].</li><li>Let <var>scope</var> be <var>realmF</var>.[[GlobalEnv]].</li><li>Perform <emu-xref aoid="FunctionInitialize" id="_ref_157"><a href="https://tc39.github.io/ecma262/#sec-functioninitialize">FunctionInitialize</a></emu-xref>(<var>F</var>, <emu-const>Normal</emu-const>, <var>parameters</var>, <var>body</var>, <var>scope</var>).</li><li>If <var>kind</var> is <code>"generator"</code>, then<ol><li>Let <var>prototype</var> be <emu-xref aoid="ObjectCreate" id="_ref_158"><a href="https://tc39.github.io/ecma262/#sec-objectcreate">ObjectCreate</a></emu-xref>(<emu-xref href="#sec-properties-of-generator-prototype"><a href="https://tc39.github.io/ecma262/#sec-properties-of-generator-prototype">%GeneratorPrototype%</a></emu-xref>).</li><li>Perform <emu-xref aoid="DefinePropertyOrThrow" id="_ref_159"><a href="https://tc39.github.io/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>F</var>, <code>"prototype"</code>, PropertyDescriptor{[[Value]]: <var>prototype</var>, [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>false</emu-val>}).</li></ol></li><li>Else if <var>kind</var> is <code>"normal"</code>, perform <emu-xref aoid="MakeConstructor" id="_ref_160"><a href="https://tc39.github.io/ecma262/#sec-makeconstructor">MakeConstructor</a></emu-xref>(<var>F</var>).</li><li>NOTE: Async functions are not constructable and do not have a [[Construct]] internal method or a <code>"prototype"</code> property.</li><li>Perform <emu-xref aoid="SetFunctionName" id="_ref_161"><a href="https://tc39.github.io/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>F</var>, <code>"anonymous"</code>).</li><li>Let <var>prefix</var> be the prefix associated with <var>kind</var> in <emu-xref href="#table-dynamic-function-sourcetext-prefixes" id="_ref_0"><a href="#table-dynamic-function-sourcetext-prefixes">Table 1</a></emu-xref>.</li><li>Let <var>sourceText</var> be the String value whose elements are, in order, the code units of <var>prefix</var>, the code units of <code>" anonymous("</code>, the code units of <var>P</var>, 0x000A (LINE FEED), the code units of <code>") {"</code>, 0x000A (LINE FEED), the code units of <var>bodyText</var>, 0x000A (LINE FEED), and the code units of <code>"}"</code>.</li><li><ins>If <var>noSourceText</var> is false, </ins>set <var>F</var>.[[SourceText]] to <var>sourceText</var>.</li><li>Return <var>F</var>.
  </li></ol></emu-alg>
  <emu-note><span class="note">Note</span><div class="note-contents">
    <p>A <code>prototype</code> property is automatically created for every function created using CreateDynamicFunction, to provide for the possibility that the function will be used as a constructor.</p>
  </div></emu-note>

  <emu-table id="table-dynamic-function-sourcetext-prefixes" caption="Dynamic Function SourceText Prefixes"><figure><figcaption>Table 1: Dynamic Function SourceText Prefixes</figcaption>
    <table>
      <tbody>
        <tr><th>Kind</th><th>Prefix</th></tr>
        <tr><td><code>"normal"</code></td><td><code>"function"</code></td></tr>
        <tr><td><code>"generator"</code></td><td><code>"function*"</code></td></tr>
        <tr><td><code>"async"</code></td><td><code>"async function"</code></td></tr>
        <tr><td><code>"async generator"</code></td><td><code>"async function*"</code></td></tr>
      </tbody>
    </table>
  </figure></emu-table>
</emu-clause>

<emu-clause id="proposal-sec-forbidden-extensions">
  <h1><span class="secnum">20</span>Forbidden Extensions</h1>

  <p>Add the following bullet point:</p>

  <ul>
    <li><ins>Runtime mechanisms for inspecting  <emu-xref href="#sec-error-objects"><a href="https://tc39.github.io/ecma262/#sec-error-objects">Error objects</a></emu-xref> must not expose the existence or source code location of <emu-xref href="#sec-function-implementation-hidden-code" id="_ref_162"><a href="#sec-function-implementation-hidden-code">function implementation hidden code</a></emu-xref>. For example, a <code>"stack"</code> property which gives a stack trace must not include such functions in the stack trace. (This is not in any way meant to restrict debugging tools, or other non-runtime introspection mechanisms.)</ins></li>
  </ul>
</emu-clause>
</div></body>